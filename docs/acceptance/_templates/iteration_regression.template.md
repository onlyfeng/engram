# Iteration Regression æ¨¡æ¿

> **ä½¿ç”¨è¯´æ˜**ï¼šå¤åˆ¶æœ¬æ¨¡æ¿åˆ° `docs/acceptance/iteration_N_regression.md`ï¼Œæ›¿æ¢ `{PLACEHOLDER}` å ä½ç¬¦ã€‚
>
> **ç´¢å¼•å…³ç³»**ï¼šåˆ›å»ºå›å½’è®°å½•åï¼Œéœ€åœ¨ [00_acceptance_matrix.md](../00_acceptance_matrix.md) çš„ã€Œè¿­ä»£å›å½’è®°å½•ç´¢å¼•ã€è¡¨ä¸­æ·»åŠ å¯¹åº”æ¡ç›®ã€‚

---

## å¿…é¡»å­—æ®µ

ä»¥ä¸‹å­—æ®µåœ¨åˆ›å»ºå›å½’è®°å½•æ—¶**å¿…é¡»å¡«å†™**ï¼š

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ‰§è¡Œæ—¥æœŸ** | YYYY-MM-DD æ ¼å¼ | `2026-02-01` |
| **æ‰§è¡Œç¯å¢ƒ** | OS å’Œæ¶æ„ä¿¡æ¯ | `darwin 24.6.0 (arm64)` |
| **Python ç‰ˆæœ¬** | Python ç‰ˆæœ¬å· | `3.13.2` |
| **pytest ç‰ˆæœ¬** | pytest ç‰ˆæœ¬å· | `9.0.2` |
| **æ‰§è¡Œç»“æœæ€»è§ˆ** | å„æµ‹è¯•é˜¶æ®µçŠ¶æ€è¡¨ | è§ä¸‹æ–¹æ¨¡æ¿ |
| **è¯¦ç»†æ‰§è¡Œè®°å½•** | æ¯ä¸ªæµ‹è¯•é˜¶æ®µçš„è¯¦ç»†ç»“æœ | è§ä¸‹æ–¹æ¨¡æ¿ |

---

## æ¨èæ®µè½ç»“æ„

```markdown
# Iteration {N} Regression - CI æµæ°´çº¿éªŒè¯è®°å½•

## æ‰§è¡Œä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **æ‰§è¡Œæ—¥æœŸ** | {YYYY-MM-DD} |
| **æ‰§è¡Œç¯å¢ƒ** | {OS} ({arch}) |
| **Python ç‰ˆæœ¬** | {python_version} |
| **pytest ç‰ˆæœ¬** | {pytest_version} |
| **æ‰§è¡Œè€…** | {æ‰§è¡Œè€…/Cursor Agent} |
| **CI è¿è¡Œ ID** | {GitHub Actions Run ID æˆ– -} |

---

## æ‰§è¡Œç»“æœæ€»è§ˆ

| åºå· | æµ‹è¯•é˜¶æ®µ | å‘½ä»¤ | çŠ¶æ€ | è¯¦æƒ… |
|------|----------|------|------|------|
| 1 | make ci | `make ci` | {STATUS} | {ç®€è¦è¯´æ˜} |
| 2 | Gateway å•å…ƒæµ‹è¯• | `pytest tests/gateway/ -q` | {STATUS} | {N} å¤±è´¥, {M} é€šè¿‡, {K} è·³è¿‡ |
| 3 | Acceptance æµ‹è¯• | `pytest tests/acceptance/ -q` | {STATUS} | {N} é€šè¿‡, {M} è·³è¿‡, {K} å¤±è´¥ |

**çŠ¶æ€å›¾ä¾‹**ï¼š
- âœ… PASS - å…¨éƒ¨é€šè¿‡
- âš ï¸ PARTIAL - éƒ¨åˆ†é€šè¿‡ï¼ˆå­˜åœ¨å¤±è´¥ä½†éé˜»æ–­ï¼‰
- âŒ FAIL - å­˜åœ¨é˜»æ–­æ€§å¤±è´¥

---

## è¯¦ç»†æ‰§è¡Œè®°å½•

### 1. make ci

**å‘½ä»¤**: `make ci`

**çŠ¶æ€**: {STATUS}

**æ‰§è¡Œæµç¨‹**:

| æ­¥éª¤ | æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| 1 | `ruff check src/ tests/` | {STATUS} | {è¯´æ˜} |
| 2 | `ruff format --check` | {STATUS} | {N} files already formatted |
| 3 | `typecheck-gate` (mypy baseline) | {STATUS} | {è¯´æ˜} |

#### 1.1 {å­é—®é¢˜æ ‡é¢˜}ï¼ˆå¦‚æœ‰å¤±è´¥ï¼‰

**é”™è¯¯ç»Ÿè®¡**:
- é—¨ç¦çº§åˆ«: {baseline/strict}
- å½“å‰é”™è¯¯æ•°: {N}
- åŸºçº¿é”™è¯¯æ•°: {M}
- å·²ä¿®å¤: {K} ä¸ª
- **æ–°å¢é”™è¯¯: {L} ä¸ª**

**æ–°å¢é”™è¯¯æ¶‰åŠçš„ä¸»è¦æ¨¡å—**:

| æ¨¡å—è·¯å¾„ | ä¸»è¦é”™è¯¯ç±»å‹ |
|----------|--------------|
| `{path}` | {error_type} |

---

### 2. Gateway å•å…ƒæµ‹è¯•

**å‘½ä»¤**: `pytest tests/gateway/ -q`

**çŠ¶æ€**: {STATUS}

**ç»Ÿè®¡**:
- é€šè¿‡: {N}
- å¤±è´¥: {M}
- è·³è¿‡: {K}
- æ‰§è¡Œæ—¶é—´: {T}s

**å¤±è´¥ç”¨ä¾‹åˆ†ç±»**ï¼ˆå¦‚æœ‰å¤±è´¥ï¼‰:

#### 2.1 {test_file.py} ({N} å¤±è´¥)

| æµ‹è¯•ç”¨ä¾‹ | å¤±è´¥åŸå›  |
|----------|----------|
| `{test_name}` | {å¤±è´¥åŸå› } |

**æ ¹æœ¬åŸå› **: {åˆ†æ}

---

### 3. Acceptance æµ‹è¯•

**å‘½ä»¤**: `pytest tests/acceptance/ -q`

**çŠ¶æ€**: {STATUS}

**ç»Ÿè®¡**:
- é€šè¿‡: {N}
- å¤±è´¥: {M}
- è·³è¿‡: {K}
- æ‰§è¡Œæ—¶é—´: {T}s

**è·³è¿‡åŸå› **: {è¯´æ˜}

---

## å¤±è´¥ä¿®å¤å»ºè®®

### P0 - CI é˜»æ–­ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

1. **{é—®é¢˜1}** ({N}ä¸ª)
   - é€‰é¡¹ A: {ä¿®å¤æ–¹æ¡ˆA}
   - é€‰é¡¹ B: {ä¿®å¤æ–¹æ¡ˆB}
   
   ä¿®å¤å‘½ä»¤:
   ```bash
   {ä¿®å¤å‘½ä»¤}
   ```

### P1 - æµ‹è¯•ä¿®å¤

2. **{é—®é¢˜2}** ({N}ä¸ªå¤±è´¥)
   - {ä¿®å¤å»ºè®®}
   - æ–‡ä»¶: `{file_path}`

---

## å¤±è´¥ä¿®å¤è¿½è¸ª

| å¤±è´¥é¡¹ | ç±»å‹ | æ¶‰åŠæ–‡ä»¶ | ä¿®å¤ PR/Commit | çŠ¶æ€ |
|--------|------|----------|----------------|------|
| {å¤±è´¥é¡¹æè¿°} | {ç±»å‹æ£€æŸ¥/æµ‹è¯•å¤±è´¥} | `{file_path}` | {PR æˆ– Commit} | â³ å¾…ä¿®å¤ / âœ… å·²ä¿®å¤ |

---

## ä¸ä¸Šä¸€è¿­ä»£å¯¹æ¯”

| æŒ‡æ ‡ | Iteration {N-1} | Iteration {N} | å˜åŒ– |
|------|-----------------|---------------|------|
| ruff lint | {STATUS} | {STATUS} | {å˜åŒ–} |
| ruff format | {STATUS} | {STATUS} | {å˜åŒ–} |
| mypy æ–°å¢é”™è¯¯ | {N} | {M} | {+/-K} |
| Gateway æµ‹è¯•å¤±è´¥ | {N} | {M} | {+/-K} |
| Acceptance æµ‹è¯• | {N} é€šè¿‡ | {M} é€šè¿‡ | {+/-K} |

**åˆ†æ**:
- {åˆ†æè¦ç‚¹1}
- {åˆ†æè¦ç‚¹2}

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ï¼ˆIteration {N+1}ï¼‰

1. **{è¡ŒåŠ¨1}** ({N} å¤±è´¥)
   - {è¯¦ç»†è¯´æ˜}

2. **{è¡ŒåŠ¨2}** ({N} å¤±è´¥)
   - {è¯¦ç»†è¯´æ˜}

### éªŒè¯å‘½ä»¤

```bash
# å®Œæ•´ CI éªŒè¯
make ci && pytest tests/gateway/ -q && pytest tests/acceptance/ -q
```

---

## ç›¸å…³æ–‡æ¡£

- [Iteration {N-1} å›å½’è®°å½•](iteration_{N-1}_regression.md)
- [éªŒæ”¶æµ‹è¯•çŸ©é˜µ](00_acceptance_matrix.md)
- [Mypy åŸºçº¿ç­–ç•¥](../architecture/adr_mypy_baseline_and_gating.md)
- [CLI å…¥å£æ–‡æ¡£](../architecture/cli_entrypoints.md)
```

---

## ä¸ 00_acceptance_matrix.md çš„ç´¢å¼•å…³ç³»

åˆ›å»ºæ–°çš„å›å½’è®°å½•åï¼Œéœ€åœ¨ [00_acceptance_matrix.md](../00_acceptance_matrix.md) çš„ã€Œè¿­ä»£å›å½’è®°å½•ç´¢å¼•ã€è¡¨ä¸­æ·»åŠ æˆ–æ›´æ–°æ¡ç›®ï¼š

```markdown
| è¿­ä»£ | æ—¥æœŸ | çŠ¶æ€ | è®¡åˆ’ | è¯¦ç»†è®°å½• | è¯´æ˜ |
|------|------|------|------|----------|------|
| **Iteration {N}** | {YYYY-MM-DD} | {STATUS} | [iteration_{N}_plan.md](iteration_{N}_plan.md) | [iteration_{N}_regression.md](iteration_{N}_regression.md) | {ç®€è¦è¯´æ˜} |
```

**ç´¢å¼•æ›´æ–°è§„åˆ™**ï¼š

1. **é¦–æ¬¡è®°å½•**ï¼šåœ¨è¡¨æ ¼ä¸­æ·»åŠ æ–°è¡Œï¼ˆæœ€æ–°è¿­ä»£åœ¨æœ€å‰ï¼‰
2. **åç»­æ›´æ–°**ï¼šæ›´æ–°åŒä¸€è¡Œçš„çŠ¶æ€å’Œè¯´æ˜å­—æ®µ
3. **æ—  Plan æ–‡ä»¶**ï¼šå¦‚æœè¿­ä»£æ²¡æœ‰ç‹¬ç«‹çš„è®¡åˆ’æ–‡ä»¶ï¼Œè®¡åˆ’åˆ—å¡« `-`

---

## çŠ¶æ€å®šä¹‰

| çŠ¶æ€ | Emoji | é€‚ç”¨åœºæ™¯ |
|------|-------|----------|
| **PASS** | âœ… | æ‰€æœ‰é—¨ç¦é€šè¿‡ï¼Œæ— é˜»æ–­æ€§å¤±è´¥ |
| **PARTIAL** | âš ï¸ | éƒ¨åˆ†é€šè¿‡ï¼šlint/format é€šè¿‡ï¼Œä½†å­˜åœ¨ mypy æ–°å¢é”™è¯¯æˆ–æµ‹è¯•å¤±è´¥ |
| **FAIL** | âŒ | å­˜åœ¨é˜»æ–­æ€§é—®é¢˜ï¼šlint å¤±è´¥ã€å…³é”®æµ‹è¯•å¤±è´¥ |
| **SUPERSEDED** | âš ï¸ | å·²è¢«åç»­è¿­ä»£å–ä»£ï¼ˆä½¿ç”¨ `âš ï¸ Superseded by Iteration {K}` æ ¼å¼æ ‡æ³¨ï¼‰ |

---

## Superseded by â€¦ï¼ˆå¯é€‰åŒºå—ï¼‰

å½“è¿­ä»£è¢«åç»­è¿­ä»£å–ä»£æ—¶ï¼Œ**å¿…é¡»**åœ¨å›å½’è®°å½•å¼€å¤´æ·»åŠ æ­¤åŒºå—ã€‚

### æ ¼å¼è¦æ±‚

```markdown
> **âš ï¸ Superseded by Iteration {K}**
>
> æœ¬è¿­ä»£å·²è¢« [Iteration {K}](iteration_{K}_regression.md) å–ä»£ï¼Œä¸å†ç»´æŠ¤ã€‚
> è¯·å‚é˜…åç»­è¿­ä»£çš„å›å½’è®°å½•è·å–æœ€æ–°éªŒæ”¶çŠ¶æ€ã€‚

---
```

**æ ¼å¼çº¦æŸ**ï¼š

| çº¦æŸ | è¦æ±‚ |
|------|------|
| **ä½ç½®** | æ–‡ä»¶æœ€å¼€å¤´ï¼Œåœ¨ä»»ä½•å…¶ä»–å†…å®¹ï¼ˆåŒ…æ‹¬æ ‡é¢˜ï¼‰ä¹‹å‰ |
| **æ ¼å¼** | ä½¿ç”¨ blockquoteï¼ˆ`>`ï¼‰åŒ…è£¹ |
| **æ ‡è¯†ç¬¦** | å¿…é¡»åŒ…å« `âš ï¸ Superseded by Iteration {K}` å­—æ ·ï¼ˆ{K} ä¸ºåç»§è¿­ä»£ç¼–å·ï¼‰ |
| **åç»§é“¾æ¥** | **å¿…é¡»**ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `[Iteration {K}](iteration_{K}_regression.md)` æ ¼å¼ï¼ŒæŒ‡å‘å®é™…å­˜åœ¨çš„åç»§è¿­ä»£å›å½’è®°å½• |
| **åˆ†éš”çº¿** | å£°æ˜åå¿…é¡»æ·»åŠ  `---` åˆ†éš”çº¿ï¼Œä¸åŸæœ‰å†…å®¹åˆ†éš” |

> **ç»Ÿä¸€æ¥æº**ï¼šæœ¬æ ¼å¼è§„èŒƒä¸ [adr_iteration_docs_workflow.md](../../architecture/adr_iteration_docs_workflow.md) çš„ R6 è§„åˆ™ä¿æŒä¸€è‡´ã€‚

### é“¾æ¥çº¦æŸï¼ˆR1-R5 è§„åˆ™ï¼‰

| çº¦æŸ | è¦æ±‚ |
|------|------|
| **R1: åç»§é“¾æ¥å¿…é¡»å­˜åœ¨** | `Iteration M` å¿…é¡»æ˜¯æœ‰æ•ˆçš„ç›¸å¯¹é“¾æ¥ï¼ŒæŒ‡å‘å®é™…å­˜åœ¨çš„å›å½’è®°å½•æ–‡ä»¶ |
| **R2: åç»§å¿…é¡»åœ¨ç´¢å¼•ä¸­** | è¢«å¼•ç”¨çš„åç»§è¿­ä»£å¿…é¡»å·²åœ¨ `00_acceptance_matrix.md` çš„ç´¢å¼•è¡¨ä¸­å‡ºç° |
| **R3: åç»§æ’åºåœ¨ä¸Šæ–¹** | åç»§è¿­ä»£åœ¨ç´¢å¼•è¡¨ä¸­çš„ä½ç½®å¿…é¡»åœ¨æœ¬è¿­ä»£**ä¸Šæ–¹**ï¼ˆæœ€æ–°è¿­ä»£åœ¨æœ€å‰ï¼‰ |
| **R4: ç¦æ­¢ç¯å½¢å¼•ç”¨** | ä¸å…è®¸ Aâ†’Bâ†’A çš„å¾ªç¯ superseded é“¾ |
| **R5: ç¦æ­¢å¤šåç»§** | æ¯ä¸ªè¿­ä»£åªèƒ½æœ‰**ä¸€ä¸ª**ç›´æ¥åç»§ï¼ˆå•ä¸€ superseded by é“¾æ¥ï¼‰ |

### ä½•æ—¶ä½¿ç”¨

- âœ… æ–°è¿­ä»£å®Œå…¨æ›¿ä»£æ—§è¿­ä»£çš„éªŒæ”¶èŒƒå›´ï¼ˆå¦‚ Iteration 9 è¢« Iteration 10 å–ä»£ï¼‰
- âœ… æ—§è¿­ä»£å­˜åœ¨çš„é—®é¢˜å·²åœ¨æ–°è¿­ä»£ä¸­ä¿®å¤å¹¶é‡æ–°éªŒæ”¶
- âœ… è¿­ä»£ç¼–å·é‡æ–°è§„åˆ’ï¼Œæ—§ç¼–å·ä¸å†ä½¿ç”¨

### ä½•æ—¶ç¦æ­¢

- âŒ æ–°è¿­ä»£ä»…æ˜¯æ—§è¿­ä»£çš„**è¡¥å……**è€Œé**å–ä»£**ï¼ˆæ­¤æ—¶ä¸¤è€…åº”å¹¶å­˜ï¼‰
- âŒ æ—§è¿­ä»£ä»åœ¨æ´»è·ƒç»´æŠ¤ä¸­
- âŒ åç»§è¿­ä»£å°šæœªåˆ›å»ºæˆ–æœªé€šè¿‡åˆå§‹éªŒæ”¶

### æœ€å°ç¤ºä¾‹

**åœºæ™¯**ï¼šIteration 7 è¢« Iteration 9 å–ä»£

åœ¨ `iteration_7_regression.md` å¼€å¤´æ·»åŠ ï¼š

```markdown
> **âš ï¸ Superseded by Iteration 9**
>
> æœ¬è¿­ä»£å·²è¢« [Iteration 9](iteration_9_regression.md) å–ä»£ï¼Œä¸å†ç»´æŠ¤ã€‚
> è¯·å‚é˜…åç»­è¿­ä»£çš„å›å½’è®°å½•è·å–æœ€æ–°éªŒæ”¶çŠ¶æ€ã€‚

---

# Iteration 7 Regression - CI æµæ°´çº¿éªŒè¯è®°å½•
ï¼ˆåŸæœ‰å†…å®¹ä¿æŒä¸å˜ï¼‰
```

åŒæ—¶åœ¨ `00_acceptance_matrix.md` ç´¢å¼•è¡¨ä¸­æ›´æ–°ï¼š

```markdown
| Iteration 9 | 2026-02-01 | âš ï¸ PARTIAL | - | [iteration_9_regression.md](iteration_9_regression.md) | å½“å‰æ´»è·ƒè¿­ä»£ |
| Iteration 7 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [iteration_7_regression.md](iteration_7_regression.md) | å·²è¢« Iteration 9 å–ä»£ |
```

---

## å¿…é¡»è®°å½•çš„æµ‹è¯•é˜¶æ®µ

ä»¥ä¸‹æµ‹è¯•é˜¶æ®µåœ¨å›å½’è®°å½•ä¸­**å¿…é¡»åŒ…å«**ï¼š

| åºå· | æµ‹è¯•é˜¶æ®µ | å‘½ä»¤ | é‡è¦æ€§ |
|------|----------|------|--------|
| 1 | **make ci** | `make ci` | **å¿…é¡»** - CI é—¨ç¦æ ¸å¿ƒ |
| 2 | **Gateway å•å…ƒæµ‹è¯•** | `pytest tests/gateway/ -q` | **å¿…é¡»** - æ ¸å¿ƒåŠŸèƒ½éªŒè¯ |
| 3 | **Acceptance æµ‹è¯•** | `pytest tests/acceptance/ -q` | **å¿…é¡»** - é›†æˆéªŒæ”¶ |

å¯é€‰è®°å½•çš„æµ‹è¯•é˜¶æ®µï¼š

| åºå· | æµ‹è¯•é˜¶æ®µ | å‘½ä»¤ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|----------|
| 4 | DI è¾¹ç•Œé—¨ç¦ | `pytest tests/gateway/test_di_boundaries.py -v` | æ¶‰åŠ DI å˜æ›´æ—¶ |
| 5 | SQL å®‰å…¨æ£€æŸ¥ | `pytest tests/logbook/test_sql_migrations_safety.py -v` | æ¶‰åŠ SQL å˜æ›´æ—¶ |
| 6 | ä¸€è‡´æ€§æ£€æŸ¥ | `python scripts/verify_*_consistency.py` | æ¶‰åŠé…ç½®å˜æ›´æ—¶ |

---

## å¿«é€Ÿåˆ›å»ºæ£€æŸ¥æ¸…å•

- [ ] å¤åˆ¶æœ¬æ¨¡æ¿åˆ° `docs/acceptance/iteration_{N}_regression.md`
- [ ] å¡«å†™æ‰€æœ‰å¿…é¡»å­—æ®µï¼ˆæ‰§è¡Œä¿¡æ¯ã€ç»“æœæ€»è§ˆã€è¯¦ç»†è®°å½•ï¼‰
- [ ] æ‰§è¡Œ `make ci` å¹¶è®°å½•ç»“æœ
- [ ] æ‰§è¡Œ `pytest tests/gateway/ -q` å¹¶è®°å½•ç»“æœ
- [ ] æ‰§è¡Œ `pytest tests/acceptance/ -q` å¹¶è®°å½•ç»“æœ
- [ ] å¦‚æœ‰å¤±è´¥ï¼Œå¡«å†™å¤±è´¥ä¿®å¤å»ºè®®å’Œè¿½è¸ªè¡¨
- [ ] ä¸ä¸Šä¸€è¿­ä»£å¯¹æ¯”ï¼Œå¡«å†™å˜åŒ–åˆ†æ
- [ ] åœ¨ [00_acceptance_matrix.md](../00_acceptance_matrix.md) æ›´æ–°ç´¢å¼•æ¡ç›®
- [ ] ç§»é™¤æ¨¡æ¿è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶é¡¶éƒ¨çš„ä½¿ç”¨è¯´æ˜åŒºå—ï¼‰

---

_æ¨¡æ¿ç‰ˆæœ¬ï¼šv1.1 | æ›´æ–°æ—¥æœŸï¼š2026-02-01ï¼ˆR6 æ ¼å¼è§„èŒƒç»Ÿä¸€ï¼‰_

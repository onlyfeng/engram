# éªŒæ”¶æµ‹è¯•çŸ©é˜µ

æœ¬æ–‡æ¡£è®°å½• Engram å„è¿­ä»£çš„éªŒæ”¶æµ‹è¯•æ‰§è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬æµ‹è¯•èŒƒå›´ã€æ‰§è¡Œç»“æœä¸å·²çŸ¥é™åˆ¶ã€‚

---

## è¿­ä»£å›å½’è®°å½•ç´¢å¼•

| è¿­ä»£ | æ—¥æœŸ | çŠ¶æ€ | è®¡åˆ’ | è¯¦ç»†è®°å½• | è¯´æ˜ |
|------|------|------|------|----------|------|
| **Iteration 15** | 2026-02-03 | âœ… PASS | [iteration_15_plan.md](iteration_15_plan.md) | [iteration_15_regression.md](iteration_15_regression.md) | make ci âœ…ï¼›pytest tests/gateway âœ…ï¼ˆ1105 passed, 206 skippedï¼‰ï¼›pytest tests/acceptance âœ…ï¼ˆ132 passed, 48 skippedï¼‰ |
| **Iteration 14** | 2026-02-02 | âœ… PASS | [iteration_14_plan.md](iteration_14_plan.md) | [iteration_14_regression.md](iteration_14_regression.md) | make ci âœ…ï¼Œcheck-iteration-docs âœ…ï¼ŒCI æµ‹è¯• 1351 passedï¼Œiteration æµ‹è¯• 440 passed |
| **Iteration 13** | 2026-02-02 | âœ… PASS | [iteration_13_plan.md](iteration_13_plan.md) | [iteration_13_regression.md](iteration_13_regression.md) | æ‰€æœ‰æœ€å°é—¨ç¦é€šè¿‡ï¼šWorkflow åˆçº¦ (v2.13.0)ã€Gateway Public APIã€CI æµ‹è¯• (608 passed)ã€Gateway æµ‹è¯• (1042 passed) |
| Iteration 12 | 2026-02-02 | âœ… PASS | [iteration_12_plan.md](iteration_12_plan.md) | [iteration_12_regression.md](iteration_12_regression.md) | Gateway æµ‹è¯•å…¨ç»¿ï¼ˆ1005 é€šè¿‡/206 è·³è¿‡ï¼‰ï¼Œä¿®å¤ ImportError/patch è·¯å¾„/çŠ¶æ€éš”ç¦»ç­‰é—®é¢˜ |
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [iteration_11_plan.md](iteration_11_plan.md) | [iteration_11_regression.md](iteration_11_regression.md) | å·²è¢« Iteration 12 å–ä»£ |
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [iteration_10_regression.md](iteration_10_regression.md) | å·²è¢« Iteration 11 å–ä»£ï¼›lint âœ…ï¼Œmypy âŒ (86 æ–°å¢)ï¼Œgateway 15 å¤±è´¥ï¼Œacceptance âœ… |
| Iteration 9 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [iteration_9_regression.md](iteration_9_regression.md) | å·²è¢« Iteration 10 å–ä»£ï¼›lint âœ…ï¼Œmypy âŒï¼Œ4 æµ‹è¯•å¤±è´¥ |
| Iteration 8 | 2026-02-01 | ğŸ”„ SUPERSEDED | [iteration_8_plan.md](iteration_8_plan.md) | [iteration_8_regression.md](iteration_8_regression.md) | å·²è¢« Iteration 9 å–ä»£ |
| Iteration 7 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [iteration_7_regression.md](iteration_7_regression.md) | å·²è¢« Iteration 9 å–ä»£ |
| Iteration 6 | 2026-01-30 | âš ï¸ PARTIAL | - | [iteration_6_regression.md](iteration_6_regression.md) | 124 ä¸ª ruff é”™è¯¯ï¼ˆå·²åœ¨ Iteration 9 ä¿®å¤ï¼‰ |
| Iteration 5 | 2026-01-29 | âœ… PASS | - | [iteration_5_regression.md](iteration_5_regression.md) | - |
| Iteration 4 | 2026-01-28 | âœ… PASS | [iteration_4_plan.md](iteration_4_plan.md) | [iteration_4_regression.md](iteration_4_regression.md) | - |
| Iteration 3 | 2026-01-27 | âœ… PASS | - | [iteration_3_regression.md](iteration_3_regression.md) | - |
| Iteration 2 | 2026-01-26 | âœ… PASS | [iteration_2_plan.md](iteration_2_plan.md) | [iteration_2_regression.md](iteration_2_regression.md) | - |

---

## SUPERSEDED ä¸€è‡´æ€§è§„åˆ™ä¸ç´¢å¼•å®Œæ•´æ€§è§„åˆ™

æœ¬èŠ‚å®šä¹‰äº†è¿­ä»£å›å½’è®°å½•ç´¢å¼•çš„ä¸€è‡´æ€§è§„åˆ™ï¼Œç”± `scripts/ci/check_no_iteration_links_in_docs.py` è‡ªåŠ¨æ ¡éªŒã€‚

### SUPERSEDED ä¸€è‡´æ€§è§„åˆ™ (R1-R6)

é€‚ç”¨äºç´¢å¼•è¡¨ä¸­çŠ¶æ€ä¸º `ğŸ”„ SUPERSEDED` çš„è¿­ä»£æ¡ç›®ã€‚

| è§„åˆ™ ID | è§„åˆ™åç§° | è¯´æ˜ |
|---------|----------|------|
| **R1** | åç»§é“¾æ¥å¿…é¡»å­˜åœ¨ | è¯´æ˜å­—æ®µå¿…é¡»åŒ…å«åç»§å£°æ˜ |
| **R2** | åç»§å¿…é¡»åœ¨ç´¢å¼•è¡¨ä¸­ | è¢«å¼•ç”¨çš„åç»§è¿­ä»£å¿…é¡»å·²åœ¨ç´¢å¼•è¡¨ä¸­å­˜åœ¨ |
| **R3** | åç»§æ’åºåœ¨ä¸Šæ–¹ | åç»§è¿­ä»£åœ¨è¡¨æ ¼ä¸­çš„ä½ç½®å¿…é¡»åœ¨è¢«å–ä»£è¿­ä»£ä¸Šæ–¹ |
| **R4** | ç¦æ­¢ç¯å½¢å¼•ç”¨ | ä¸å…è®¸ Aâ†’Bâ†’A çš„å¾ªç¯å–ä»£é“¾ |
| **R5** | ç¦æ­¢å¤šåç»§ | æ¯ä¸ªè¿­ä»£åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥åç»§ |
| **R6** | regression å£°æ˜å¿…é¡»å­˜åœ¨ | regression æ–‡ä»¶é¡¶éƒ¨å¿…é¡»æœ‰æ ‡å‡† superseded å£°æ˜ |

#### R1: åç»§é“¾æ¥å¿…é¡»å­˜åœ¨

**è¦æ±‚**: SUPERSEDED è¿­ä»£çš„ã€Œè¯´æ˜ã€å­—æ®µå¿…é¡»åŒ…å«åç»§å£°æ˜ã€‚

**æ ¼å¼è¦æ±‚**:
- `å·²è¢« Iteration X å–ä»£`ï¼ˆä¸­æ–‡ï¼‰
- `Superseded by Iteration X`ï¼ˆè‹±æ–‡ï¼‰

**âœ… æ­£ç¡®ç¤ºä¾‹**:

```markdown
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [...] | å·²è¢« Iteration 11 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**:

```markdown
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [...] | æ–‡æ¡£æ•´ç† |
```

**ä¿®å¤å»ºè®®**: åœ¨è¯´æ˜å­—æ®µæ·»åŠ  `å·²è¢« Iteration X å–ä»£`ã€‚

#### R2: åç»§å¿…é¡»åœ¨ç´¢å¼•è¡¨ä¸­

**è¦æ±‚**: åç»§å£°æ˜ä¸­å¼•ç”¨çš„è¿­ä»£å¿…é¡»å·²å­˜åœ¨äºç´¢å¼•è¡¨ä¸­ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼ˆIteration 12 å·²åœ¨ç´¢å¼•è¡¨ä¸­ï¼‰:

```markdown
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [...] | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 12 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**ï¼ˆIteration 13 ä¸åœ¨ç´¢å¼•è¡¨ä¸­ï¼‰:

```markdown
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 13 å–ä»£ |
```

**ä¿®å¤å»ºè®®**: å…ˆåœ¨ç´¢å¼•è¡¨ä¸­æ·»åŠ åç»§è¿­ä»£æ¡ç›®ï¼Œå†æ ‡è®°å½“å‰è¿­ä»£ä¸º SUPERSEDEDã€‚

#### R3: åç»§æ’åºåœ¨ä¸Šæ–¹

**è¦æ±‚**: åç»§è¿­ä»£åœ¨ç´¢å¼•è¡¨ä¸­çš„ä½ç½®å¿…é¡»åœ¨è¢«å–ä»£è¿­ä»£çš„ä¸Šæ–¹ï¼ˆè¡Œå·æ›´å°ï¼‰ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼ˆIteration 12 åœ¨ Iteration 11 ä¸Šæ–¹ï¼‰:

```markdown
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [...] | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 12 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**ï¼ˆIteration 12 åœ¨ Iteration 11 ä¸‹æ–¹ï¼‰:

```markdown
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 12 å–ä»£ |
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [...] | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
```

**ä¿®å¤å»ºè®®**: è°ƒæ•´ç´¢å¼•è¡¨è¡Œé¡ºåºï¼Œå°†åç»§è¿­ä»£ç§»åˆ°è¢«å–ä»£è¿­ä»£çš„ä¸Šæ–¹ã€‚

#### R4: ç¦æ­¢ç¯å½¢å¼•ç”¨

**è¦æ±‚**: ä¸å…è®¸å½¢æˆå¾ªç¯å–ä»£é“¾ï¼ˆå¦‚ Aâ†’Bâ†’A æˆ– Aâ†’Bâ†’Câ†’Aï¼‰ã€‚

**âŒ å¤±è´¥ç¤ºä¾‹**:

```markdown
| Iteration 11 | ... | ğŸ”„ SUPERSEDED | ... | ... | å·²è¢« Iteration 12 å–ä»£ |
| Iteration 12 | ... | ğŸ”„ SUPERSEDED | ... | ... | å·²è¢« Iteration 11 å–ä»£ |
```

**ä¿®å¤å»ºè®®**: æ£€æŸ¥å–ä»£é“¾ï¼Œç¡®ä¿å½¢æˆå•å‘ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ã€‚

#### R5: ç¦æ­¢å¤šåç»§

**è¦æ±‚**: æ¯ä¸ªè¿­ä»£åªèƒ½å£°æ˜ä¸€ä¸ªç›´æ¥åç»§ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**:

```markdown
| Iteration 10 | ... | ğŸ”„ SUPERSEDED | ... | ... | å·²è¢« Iteration 11 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**:

```markdown
| Iteration 10 | ... | ğŸ”„ SUPERSEDED | ... | ... | å·²è¢« Iteration 11ã€Iteration 12 å–ä»£ |
```

**ä¿®å¤å»ºè®®**: ä¿ç•™æœ€ç»ˆåç»§ï¼Œç§»é™¤å¤šä½™çš„åç»§å£°æ˜ã€‚

#### R6: regression å£°æ˜å¿…é¡»å­˜åœ¨

**è¦æ±‚**: SUPERSEDED è¿­ä»£çš„ regression æ–‡ä»¶**å‰ 20 è¡Œå†…**å¿…é¡»åŒ…å«å…³é”®çŸ­è¯­ `Superseded by Iteration M`ï¼Œä¸”åç»§ç¼–å· M å¿…é¡»ä¸ç´¢å¼•è¡¨ä¸€è‡´ã€‚

**CI æ£€æŸ¥é€»è¾‘**ï¼ˆ`scripts/ci/check_no_iteration_links_in_docs.py::check_regression_file_superseded_header`ï¼‰:
1. æ‰«ææ–‡ä»¶å‰ 20 è¡Œ
2. ä½¿ç”¨æ­£åˆ™ `Superseded\s+by\s+Iteration\s*(\d+)`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰åŒ¹é…
3. éªŒè¯å£°æ˜ä¸­çš„åç»§ç¼–å·ä¸ç´¢å¼•è¡¨ä¸€è‡´

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼ˆæ–‡ä»¶ `iteration_10_regression.md` é¡¶éƒ¨ï¼‰:

```markdown
> **âš ï¸ Superseded by Iteration 11**
>
> æœ¬è¿­ä»£å·²è¢« [Iteration 11](iteration_11_regression.md) å–ä»£ï¼Œä¸å†ç»´æŠ¤ã€‚
> è¯·å‚é˜…åç»­è¿­ä»£çš„å›å½’è®°å½•è·å–æœ€æ–°éªŒæ”¶çŠ¶æ€ã€‚

---

# Iteration 10 å›å½’éªŒè¯
ï¼ˆåŸæœ‰å†…å®¹ï¼‰
```

**æ ¼å¼çº¦æŸ**:

| çº¦æŸ | è¦æ±‚ |
|------|------|
| **ä½ç½®** | æ–‡ä»¶å‰ 20 è¡Œå†…ï¼ˆæ¨èåœ¨æ ‡é¢˜ä¹‹å‰ï¼Œä»¥ä¾¿è¯»è€…ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ï¼‰ |
| **æ ¼å¼** | ä½¿ç”¨ blockquoteï¼ˆ`>`ï¼‰åŒ…è£¹ |
| **å…³é”®çŸ­è¯­** | å¿…é¡»åŒ…å« `Superseded by Iteration M` å­—æ ·ï¼ˆM ä¸ºåç»§è¿­ä»£ç¼–å·ï¼‰ |
| **åç»§é“¾æ¥** | å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `[Iteration M](iteration_M_regression.md)` æ ¼å¼ |
| **ç¼–å·ä¸€è‡´æ€§** | M å¿…é¡»ä¸ç´¢å¼•è¡¨ã€Œè¯´æ˜ã€å­—æ®µå£°æ˜çš„åç»§ç¼–å·ä¸€è‡´ |

**âŒ å¤±è´¥ç¤ºä¾‹ 1**ï¼ˆç¼ºå°‘ superseded å£°æ˜ï¼‰:

```markdown
# Iteration 10 å›å½’éªŒè¯

æœ¬æ–‡æ¡£è®°å½• Iteration 10 çš„å›å½’éªŒè¯ç»“æœã€‚
```

**âŒ å¤±è´¥ç¤ºä¾‹ 2**ï¼ˆsuperseded ç¼–å·ä¸ç´¢å¼•è¡¨ä¸ä¸€è‡´ï¼‰:

ç´¢å¼•è¡¨å£°æ˜ã€Œå·²è¢« Iteration 11 å–ä»£ã€ï¼Œä½† regression æ–‡ä»¶å†™çš„æ˜¯ï¼š

```markdown
> **âš ï¸ Superseded by Iteration 12**
```

**ä¿®å¤å»ºè®®**: åœ¨ regression æ–‡ä»¶å‰ 20 è¡Œå†…æ·»åŠ æ ‡å‡†å£°æ˜ï¼Œç¡®ä¿åç»§ç¼–å·ä¸ç´¢å¼•è¡¨ä¸€è‡´ã€‚

### ç´¢å¼•å®Œæ•´æ€§è§„åˆ™ (R7-R9)

é€‚ç”¨äºæ•´ä¸ªç´¢å¼•è¡¨çš„å®Œæ•´æ€§æ ¡éªŒã€‚

| è§„åˆ™ ID | è§„åˆ™åç§° | è¯´æ˜ |
|---------|----------|------|
| **R7** | é“¾æ¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ | ç´¢å¼•è¡¨ä¸­ plan_link/regression_link æŒ‡å‘çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨ |
| **R8** | æ–‡ä»¶å¿…é¡»è¢«ç´¢å¼• | `docs/acceptance/iteration_*_regression.md` å¿…é¡»åœ¨ç´¢å¼•è¡¨ä¸­ |
| **R9** | ç´¢å¼•é™åºæ’åˆ— | ç´¢å¼•è¡¨ä¸­ iteration ç¼–å·å¿…é¡»é™åºï¼ˆæœ€æ–°è¿­ä»£åœ¨æœ€å‰ï¼‰ |

#### R7: é“¾æ¥æ–‡ä»¶å¿…é¡»å­˜åœ¨

**è¦æ±‚**: ç´¢å¼•è¡¨ä¸­å¼•ç”¨çš„ plan æˆ– regression æ–‡ä»¶å¿…é¡»å®é™…å­˜åœ¨äº `docs/acceptance/` ç›®å½•ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼ˆæ–‡ä»¶ `iteration_12_plan.md` å­˜åœ¨ï¼‰:

```markdown
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [iteration_12_plan.md](iteration_12_plan.md) | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰:

```markdown
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [iteration_12_plan.md](iteration_12_plan.md) | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
# ä½† docs/acceptance/iteration_12_plan.md æ–‡ä»¶ä¸å­˜åœ¨
```

**ä¿®å¤å»ºè®®**:
- åˆ›å»ºç¼ºå¤±çš„æ–‡ä»¶ï¼Œæˆ–
- å°†é“¾æ¥æ”¹ä¸º `-`ï¼ˆè¡¨ç¤ºæ— è®¡åˆ’æ–‡æ¡£ï¼‰

#### R8: æ–‡ä»¶å¿…é¡»è¢«ç´¢å¼•

**è¦æ±‚**: `docs/acceptance/` ç›®å½•ä¸‹çš„ `iteration_*_regression.md` å’Œ `iteration_*_plan.md` æ–‡ä»¶å¿…é¡»åœ¨ç´¢å¼•è¡¨ä¸­æœ‰å¯¹åº”æ¡ç›®ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼ˆæ–‡ä»¶å·²åœ¨ç´¢å¼•ä¸­å¼•ç”¨ï¼‰:

æ–‡ä»¶ `docs/acceptance/iteration_10_regression.md` å­˜åœ¨ï¼Œä¸”ç´¢å¼•è¡¨æœ‰ï¼š

```markdown
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | - | [iteration_10_regression.md](iteration_10_regression.md) | å·²è¢« Iteration 11 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**ï¼ˆå­¤å„¿æ–‡ä»¶ï¼‰:

æ–‡ä»¶ `docs/acceptance/iteration_10_regression.md` å­˜åœ¨ï¼Œä½†ç´¢å¼•è¡¨ä¸­æ²¡æœ‰ Iteration 10 æ¡ç›®ã€‚

**ä¿®å¤å»ºè®®**:
- åœ¨ç´¢å¼•è¡¨ä¸­æ·»åŠ å¯¹åº”çš„è¿­ä»£æ¡ç›®ï¼Œæˆ–
- åˆ é™¤ä¸å†éœ€è¦çš„å­¤å„¿æ–‡ä»¶

#### R9: ç´¢å¼•é™åºæ’åˆ—

**è¦æ±‚**: ç´¢å¼•è¡¨ä¸­çš„è¿­ä»£ç¼–å·å¿…é¡»æŒ‰é™åºæ’åˆ—ï¼ˆæœ€æ–°è¿­ä»£åœ¨æœ€å‰ï¼‰ã€‚

**âœ… æ­£ç¡®ç¤ºä¾‹**:

```markdown
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [...] | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 12 å–ä»£ |
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 11 å–ä»£ |
```

**âŒ å¤±è´¥ç¤ºä¾‹**ï¼ˆé¡ºåºé”™è¯¯ï¼‰:

```markdown
| Iteration 10 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 11 å–ä»£ |
| Iteration 11 | 2026-02-01 | ğŸ”„ SUPERSEDED | [...] | [...] | å·²è¢« Iteration 12 å–ä»£ |
| **Iteration 12** | 2026-02-02 | âš ï¸ PARTIAL | [...] | [...] | å½“å‰æ´»è·ƒè¿­ä»£ |
```

**ä¿®å¤å»ºè®®**: å°† Iteration 12 è¡Œç§»åˆ°è¡¨æ ¼æœ€ä¸Šæ–¹ï¼ŒIteration 11 æ¬¡ä¹‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚

### æ ¡éªŒå‘½ä»¤

```bash
# å®Œæ•´æ£€æŸ¥ï¼ˆ.iteration/ é“¾æ¥ + SUPERSEDED + ç´¢å¼•å®Œæ•´æ€§ï¼‰
python scripts/ci/check_no_iteration_links_in_docs.py

# ä»…æ£€æŸ¥ SUPERSEDED ä¸€è‡´æ€§
python scripts/ci/check_no_iteration_links_in_docs.py --superseded-only

# ä»…æ£€æŸ¥ç´¢å¼•å®Œæ•´æ€§
python scripts/ci/check_no_iteration_links_in_docs.py --integrity-only

# è¯¦ç»†è¾“å‡º
python scripts/ci/check_no_iteration_links_in_docs.py --verbose

# ä»…ç»Ÿè®¡ï¼ˆä¸é˜»æ–­ CIï¼‰
python scripts/ci/check_no_iteration_links_in_docs.py --stats-only

# è¾“å‡ºæœºå™¨å¯è¯»çš„ JSON ä¿®å¤å»ºè®®ï¼ˆå¿«é€Ÿå®šä½ R3/R9 æ’åºé—®é¢˜ï¼‰
python scripts/ci/check_no_iteration_links_in_docs.py --suggest-fixes
```

### å¿«é€Ÿå®šä½æ’åºé—®é¢˜ï¼ˆ--suggest-fixesï¼‰

å½“é‡åˆ° R3ï¼ˆåç»§æ’åºåœ¨ä¸‹æ–¹ï¼‰æˆ– R9ï¼ˆç´¢å¼•é™åºæ’åˆ—ï¼‰è¿è§„æ—¶ï¼Œå¯ä½¿ç”¨ `--suggest-fixes` è¾“å‡ºæœºå™¨å¯è¯»çš„ JSON ä¿®å¤å»ºè®®ï¼š

```bash
# è¾“å‡º JSON æ ¼å¼çš„ä¿®å¤å»ºè®®
python scripts/ci/check_no_iteration_links_in_docs.py --suggest-fixes
```

**è¾“å‡ºç¤ºä¾‹**ï¼ˆR3 è¿è§„ï¼‰ï¼š

```json
{
  "violations_count": 1,
  "suggestions_count": 1,
  "suggestions": [
    {
      "rule_id": "R3",
      "iteration_number": 7,
      "action": "move_above",
      "description": "å°† Iteration 9 è¡Œç§»åŠ¨åˆ° Iteration 7 è¡Œçš„ä¸Šæ–¹",
      "target_iteration": 9,
      "file": "docs/acceptance/00_acceptance_matrix.md"
    }
  ]
}
```

**è¾“å‡ºç¤ºä¾‹**ï¼ˆR9 è¿è§„ï¼‰ï¼š

```json
{
  "violations_count": 1,
  "suggestions_count": 1,
  "suggestions": [
    {
      "rule_id": "R9",
      "iteration_number": 10,
      "action": "move_above",
      "description": "å°† Iteration 10 è¡Œç§»åŠ¨åˆ° Iteration 5 è¡Œçš„ä¸Šæ–¹ï¼ˆç´¢å¼•åº”æŒ‰è¿­ä»£ç¼–å·é™åºæ’åˆ—ï¼‰",
      "target_iteration": 5,
      "file": "docs/acceptance/00_acceptance_matrix.md"
    }
  ]
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `rule_id` | è¿åçš„è§„åˆ™ IDï¼ˆR1-R9ï¼‰ |
| `iteration_number` | è¿è§„çš„è¿­ä»£ç¼–å· |
| `action` | å»ºè®®çš„æ“ä½œç±»å‹ï¼ˆå¦‚ `move_above`ã€`add_successor_declaration`ï¼‰ |
| `description` | äººç±»å¯è¯»çš„ä¿®å¤è¯´æ˜ |
| `target_iteration` | ç›®æ ‡è¿­ä»£ç¼–å·ï¼ˆç§»åŠ¨æ“ä½œæ—¶æŒ‡å®šï¼‰ |
| `file` | éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶è·¯å¾„ |

**ä½¿ç”¨åœºæ™¯**ï¼š

1. **CI å¤±è´¥å¿«é€Ÿå®šä½**ï¼šå°† JSON è¾“å‡ºè§£æåç›´æ¥å®šä½éœ€è¦ä¿®æ”¹çš„è¡Œ
2. **è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬**ï¼šåŸºäº `action` å’Œ `target_iteration` å­—æ®µå®ç°è‡ªåŠ¨ä¿®å¤
3. **ç¼–è¾‘å™¨é›†æˆ**ï¼šIDE æ’ä»¶å¯è§£æè¾“å‡ºå¹¶æä¾› Quick Fix åŠŸèƒ½

**æ³¨æ„**ï¼š`--suggest-fixes` ä¸æ”¹å˜é˜»æ–­é€»è¾‘ï¼Œä»…æä¾›é¢å¤–çš„æœºå™¨å¯è¯»è¾“å‡ºã€‚å­˜åœ¨è¿è§„æ—¶ä»è¿”å›é€€å‡ºç  1ã€‚

---

## æ¨¡æ¿è¯´æ˜

æ¯æ¬¡éªŒæ”¶è®°å½•åº”åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µ | è¯´æ˜ |
|------|------|
| **æ—¥æœŸ** | éªŒæ”¶æ‰§è¡Œæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| **Commit** | è¢«éªŒæ”¶çš„ commit SHA |
| **ç¯å¢ƒ** | æ‰§è¡Œç¯å¢ƒï¼ˆOSã€Docker ç‰ˆæœ¬ã€æ•°æ®åº“ç‰ˆæœ¬ç­‰ï¼‰ |
| **æ‰§è¡Œå‘½ä»¤** | å®é™…è¿è¡Œçš„éªŒæ”¶å‘½ä»¤ |
| **ç»“æœ** | PASS / PARTIAL / FAIL |
| **å·²çŸ¥é™åˆ¶** | å½“å‰è¿­ä»£çš„å·²çŸ¥é™åˆ¶ä¸çº¦æŸ |
| **æœªè¦†ç›–èŒƒå›´** | æœ¬æ¬¡æœªæ‰§è¡Œçš„æµ‹è¯•åŠåŸå›  |
| **é£é™©è¯„ä¼°** | æœªè¦†ç›–èŒƒå›´å¸¦æ¥çš„æ½œåœ¨é£é™© |

---

## æœ¬åœ°å¤ç° CI çš„æœ€å°å‘½ä»¤é›†

æœ¬èŠ‚è¯´æ˜å¦‚ä½•åœ¨æœ¬åœ°ç¯å¢ƒä¸­å¤ç° GitHub Actions CI çš„å…¨éƒ¨æ£€æŸ¥ã€‚

### å¿«é€Ÿè¿è¡Œï¼ˆå•å‘½ä»¤ï¼‰

```bash
# è¿è¡Œæ‰€æœ‰ CI æ£€æŸ¥ï¼ˆä¸ GitHub Actions å¯¹é½ï¼‰
make ci
```

### CI æ£€æŸ¥é¡¹å¯¹ç…§è¡¨

| CI Job | Makefile ç›®æ ‡ | è„šæœ¬/å‘½ä»¤ | è¯´æ˜ |
|--------|---------------|-----------|------|
| **lint** | `make lint` | `ruff check src/ tests/` | ä»£ç  lint æ£€æŸ¥ |
| **lint** | `make format-check` | `ruff format --check src/ tests/` | ä»£ç æ ¼å¼æ£€æŸ¥ |
| **lint** | `make typecheck-gate` | `scripts/ci/check_mypy_gate.py --gate baseline` | mypy åŸºçº¿å¯¹æ¯”æ£€æŸ¥ |
| **mypy-strict-island** | `make typecheck-strict-island` | `scripts/ci/check_mypy_gate.py --gate strict-island` | æ ¸å¿ƒæ¨¡å— mypy strict æ£€æŸ¥ |
| **mypy-metrics** | `make typecheck-metrics` | `scripts/ci/mypy_metrics.py --output artifacts/mypy_metrics.json` | mypy æŒ‡æ ‡æŠ¥å‘Šï¼ˆæ¡ç›®æ•°ã€ç›®å½•åˆ†å¸ƒã€error-code åˆ†å¸ƒï¼‰ |
| **schema-validate** | `make check-schemas` | `scripts/validate_schemas.py --validate-fixtures` | JSON Schema æ ¡éªŒ |
| **env-var-consistency** | `make check-env-consistency` | `scripts/ci/check_env_var_consistency.py` | ç¯å¢ƒå˜é‡ä¸€è‡´æ€§ |
| **logbook-consistency** | `make check-logbook-consistency` | `scripts/verify_logbook_consistency.py` | Logbook é…ç½®ä¸€è‡´æ€§ |
| **migration-sanity** | `make check-migration-sanity` | SQL æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥ | SQL è¿ç§»æ–‡ä»¶æ£€æŸ¥ |
| **scm-sync-consistency** | `make check-scm-sync-consistency` | `scripts/verify_scm_sync_consistency.py` | SCM Sync ä¸€è‡´æ€§ |
| **sql-safety** | `make check-sql-safety` | `pytest tests/logbook/test_sql_migrations_safety.py` | SQL é«˜å±è¯­å¥æ£€æµ‹ |
| **gateway-di-boundaries** | `make check-gateway-di-boundaries` | `scripts/ci/check_gateway_di_boundaries.py` | Gateway DI è¾¹ç•Œæ£€æŸ¥ |
| **no-root-wrappers-usage** | `make check-no-root-wrappers` | `scripts/ci/check_no_root_wrappers_usage.py` | æ ¹ç›®å½• wrapper å¯¼å…¥ç¦ä»¤ |
| **cli-entrypoints-consistency** | `make check-cli-entrypoints` | `scripts/verify_cli_entrypoints_consistency.py` | CLI å…¥å£ç‚¹ä¸€è‡´æ€§ |
| **test** | `make test-gateway` | `pytest tests/gateway/ -v` | Gateway æµ‹è¯•ï¼ˆéœ€æ•°æ®åº“ï¼‰ |
| **test** | `make test-acceptance` | `pytest tests/acceptance/ -v` | éªŒæ”¶æµ‹è¯•ï¼ˆéœ€æ•°æ®åº“ï¼‰ |

### åˆ†æ­¥è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰

```bash
# 1. ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆæ— éœ€æ•°æ®åº“ï¼‰
make lint              # ruff lintï¼ˆå…¨é‡æ£€æŸ¥ï¼‰
make lint-f821         # ruff lintï¼ˆä¸“é¡¹ï¼šF821 æœªå®šä¹‰åç§°ï¼‰
make format-check      # ruff format æ£€æŸ¥
make typecheck-gate    # mypy åŸºçº¿å¯¹æ¯”
make typecheck-strict-island  # mypy strict-island æ ¸å¿ƒæ¨¡å—

# 2. ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæ— éœ€æ•°æ®åº“ï¼‰
make check-schemas            # JSON Schema æ ¡éªŒ
make check-env-consistency    # ç¯å¢ƒå˜é‡ä¸€è‡´æ€§
make check-logbook-consistency # Logbook é…ç½®ä¸€è‡´æ€§
make check-migration-sanity   # SQL æ–‡ä»¶æ£€æŸ¥
make check-scm-sync-consistency # SCM Sync ä¸€è‡´æ€§

# 3. è¾¹ç•Œä¸å®‰å…¨æ£€æŸ¥ï¼ˆæ— éœ€æ•°æ®åº“ï¼‰
make check-sql-safety           # SQL é«˜å±è¯­å¥æ£€æµ‹
make check-gateway-di-boundaries # Gateway DI è¾¹ç•Œ
make check-no-root-wrappers     # æ ¹ç›®å½• wrapper ç¦ä»¤
make check-cli-entrypoints      # CLI å…¥å£ç‚¹ä¸€è‡´æ€§

# 4. æµ‹è¯•ï¼ˆéœ€è¦æ•°æ®åº“ï¼‰
# å…ˆå¯åŠ¨æ•°æ®åº“æœåŠ¡
export POSTGRES_DSN="postgresql://postgres:postgres@localhost:5432/engram_test"
export TEST_PG_DSN="$POSTGRES_DSN"
export TEST_PG_ADMIN_DSN="postgresql://postgres:postgres@localhost:5432/postgres"

make test-gateway      # Gateway æµ‹è¯•
make test-acceptance   # éªŒæ”¶æµ‹è¯•
```

### CI ä¸ Makefile ç¯å¢ƒå˜é‡å¯¹ç…§

| CI ç¯å¢ƒå˜é‡ | Makefile/æœ¬åœ°å€¼ | è¯´æ˜ |
|-------------|-----------------|------|
| `POSTGRES_DSN` | `postgresql://postgres:postgres@localhost:5432/engram_test` | æ•°æ®åº“è¿æ¥ |
| `TEST_PG_DSN` | åŒ `POSTGRES_DSN` | æµ‹è¯•ç”¨æ•°æ®åº“è¿æ¥ |
| `TEST_PG_ADMIN_DSN` | `postgresql://postgres:postgres@localhost:5432/postgres` | ç®¡ç†å‘˜è¿æ¥ï¼ˆDDL æ“ä½œï¼‰ |
| `ENGRAM_TESTING` | `1` | æµ‹è¯•æ¨¡å¼æ ‡å¿— |
| `ENGRAM_VERIFY_GATE` | `strict` | éªŒè¯é—¨ç¦çº§åˆ« |
| `ENGRAM_MYPY_GATE` | `baseline` | mypy é—¨ç¦æ¨¡å¼ï¼ˆå…¼å®¹ `MYPY_GATE`ï¼‰ |
| `PROJECT_KEY` | `test` | é¡¹ç›®æ ‡è¯† |

### ä¸“é¡¹ Lint æ£€æŸ¥ä½¿ç”¨è¯´æ˜

é™¤å…¨é‡ `make lint` å¤–ï¼Œè¿˜æä¾›ä¸“é¡¹ lint æ£€æŸ¥ç›®æ ‡ï¼Œç”¨äºå¿«é€Ÿå®šä½ç‰¹å®šç±»å‹é—®é¢˜ï¼š

| ç›®æ ‡ | æ£€æŸ¥å†…å®¹ | ä½¿ç”¨åœºæ™¯ |
|------|----------|----------|
| `make lint` | å…¨é‡ ruff æ£€æŸ¥ | CI é—¨ç¦ã€PR åˆå…¥å‰ã€å®Œæ•´ä»£ç å®¡æŸ¥ |
| `make lint-f821` | F821 undefined-nameï¼ˆæœªå®šä¹‰åç§°ï¼‰ | å¿«é€Ÿå®šä½å˜é‡/å‡½æ•°æœªå®šä¹‰é”™è¯¯ã€é‡æ„åæ£€æŸ¥é—æ¼ |

**ä½•æ—¶ä½¿ç”¨ä¸“é¡¹æ£€æŸ¥**ï¼š
- **å¿«é€Ÿè¿­ä»£è°ƒè¯•**ï¼šä¿®æ”¹ä»£ç ååªå…³å¿ƒç‰¹å®šç±»å‹é”™è¯¯æ—¶ï¼Œä¸“é¡¹æ£€æŸ¥æ›´å¿«
- **é‡æ„åéªŒè¯**ï¼šåˆ é™¤/é‡å‘½åå‡½æ•°åï¼Œç”¨ `lint-f821` å¿«é€Ÿæ£€æµ‹é—æ¼çš„å¼•ç”¨
- **CI å¤±è´¥æ’æŸ¥**ï¼šCI æŠ¥å‘Š F821 é”™è¯¯æ—¶ï¼Œæœ¬åœ°ç”¨ä¸“é¡¹æ£€æŸ¥å¿«é€Ÿå¤ç°

**ä½•æ—¶ä½¿ç”¨å…¨é‡æ£€æŸ¥**ï¼š
- **PR æäº¤å‰**ï¼šç¡®ä¿æ‰€æœ‰ lint è§„åˆ™é€šè¿‡
- **CI é—¨ç¦**ï¼š`make ci` åŒ…å«å…¨é‡ lint
- **ä»£ç å®¡æŸ¥**ï¼šå…¨é¢è¯„ä¼°ä»£ç è´¨é‡

### æ³¨æ„äº‹é¡¹

1. **æ— æ•°æ®åº“æ£€æŸ¥**ï¼š`make ci` ä¸­çš„å¤§éƒ¨åˆ†æ£€æŸ¥æ— éœ€æ•°æ®åº“ï¼Œä»… `check-sql-safety` éœ€è¦ pytest ä½†ä¸éœ€è¦çœŸå®æ•°æ®åº“è¿æ¥
2. **å®Œæ•´æµ‹è¯•**ï¼šè¿è¡Œ `make test` éœ€è¦ PostgreSQL + pgvector æœåŠ¡
3. **CI ç²¾ç¡®å¤ç°**ï¼šè‹¥éœ€å®Œå…¨å¤ç° CI ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ Docker:
   ```bash
   docker compose -f docker-compose.unified.yml up -d postgres
   make ci && make test
   ```

---

## mypy ç±»å‹åŒ–å¥åº·æŒ‡æ ‡

> **è¯¦ç»†ç­–ç•¥**ï¼šå‚è§ [ADR: mypy åŸºçº¿ç®¡ç†ä¸ Gate é—¨ç¦ç­–ç•¥](../architecture/adr_mypy_baseline_and_gating.md)
>
> **CI Artifact**ï¼š`artifacts/mypy_metrics.json`ï¼ˆç”± `scripts/ci/mypy_metrics.py` ç”Ÿæˆï¼‰

### mypy_metrics.json ç»“æ„è¯´æ˜

CI æ¯æ¬¡è¿è¡Œä¼šç”Ÿæˆ `mypy_metrics.json`ï¼ŒåŒ…å«ä»¥ä¸‹æŒ‡æ ‡ï¼š

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `summary.total_errors` | Baseline ä¸­çš„é”™è¯¯æ€»æ•°ï¼ˆä¸å« noteï¼‰ |
| `summary.total_notes` | Baseline ä¸­çš„ note æ€»æ•°ï¼ˆä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰ |
| `by_directory` | æŒ‰ç›®å½•å‰ç¼€ï¼ˆ`src/engram/gateway/`ã€`src/engram/logbook/`ï¼‰èšåˆçš„é”™è¯¯åˆ†å¸ƒ |
| `by_error_code` | æŒ‰ mypy error-codeï¼ˆå¦‚ `[arg-type]`ã€`[return-value]`ï¼‰èšåˆçš„é”™è¯¯åˆ†å¸ƒ |
| `by_error_type` | æŒ‰é”™è¯¯ç±»å‹æè¿°ï¼ˆå¦‚ "Incompatible types in"ï¼‰èšåˆçš„ top 20 |
| `strict_island.paths` | pyproject.toml ä¸­é…ç½®çš„ Strict Island è·¯å¾„åˆ—è¡¨ |
| `strict_island.count` | Strict Island è·¯å¾„æ•°é‡ |

### æ ¸å¿ƒæŒ‡æ ‡å®šä¹‰

| æŒ‡æ ‡ | å®šä¹‰ | æŸ¥è¯¢å‘½ä»¤ | ç›®æ ‡å€¼ |
|------|------|----------|--------|
| **Baseline æ¡ç›®æ•°** | åŸºçº¿æ–‡ä»¶ä¸­çš„é”™è¯¯æ€»æ•° | `wc -l scripts/ci/mypy_baseline.txt` | 0 |
| **Strict Island è¦†ç›–ç‡** | å·²å¯ç”¨ strict çš„æ¨¡å—å æ¯” | è§ `pyproject.toml` çš„ `[[tool.mypy.overrides]]` | 100% |
| **è¿‘ 30 å¤©æ–°å¢é”™è¯¯** | æœ€è¿‘ 30 å¤©åŸºçº¿å‡€å¢åŠ æ•° | `git log -p --since="30 days ago" -- scripts/ci/mypy_baseline.txt` | 0 |

### å½“å‰æŒ‡æ ‡çŠ¶æ€

| æŒ‡æ ‡ | å½“å‰å€¼ | çŠ¶æ€ | æ›´æ–°æ—¥æœŸ |
|------|--------|------|----------|
| Baseline æ¡ç›®æ•° | ~143 | ğŸ”´ çº¢è‰² | 2026-02-01 |
| Strict Island è¦†ç›–ç‡ | ~25% (17 modules) | ğŸŸ¡ é»„è‰² | 2026-02-01 |
| è¿‘ 30 å¤©æ–°å¢é”™è¯¯ | 0 | ğŸŸ¢ ç»¿è‰² | 2026-02-01 |

### åˆ‡æ¢é˜¶æ®µè¿½è¸ª

| é˜¶æ®µ | æè¿° | è§¦å‘æ¡ä»¶ | çŠ¶æ€ |
|------|------|----------|------|
| **é˜¶æ®µ 0** | Gate=baselineï¼ˆæ‰€æœ‰åˆ†æ”¯ï¼‰ | - | **å½“å‰** |
| **é˜¶æ®µ 1** | master=strict, PR=baseline | åŸºçº¿ â‰¤ 20 | å¾…è§¦å‘ |
| **é˜¶æ®µ 2** | æ‰€æœ‰åˆ†æ”¯=strict | åŸºçº¿ = 0, é˜¶æ®µ 1 ç¨³å®š 2 å‘¨ | å¾…è§¦å‘ |
| **é˜¶æ®µ 3** | å½’æ¡£åŸºçº¿æ–‡ä»¶ï¼Œå…¨é¢ strict | é˜¶æ®µ 2 ç¨³å®š 2 å‘¨ | å¾…è§¦å‘ |

### è¿­ä»£æ”¶æ•›è®¡åˆ’

| è¿­ä»£ | æ”¶æ•›èŒƒå›´ | ç›®æ ‡é”™è¯¯æ•° | çŠ¶æ€ |
|------|----------|------------|------|
| v1.0 | `src/engram/gateway/` | < 100 | ğŸ“‹ è¿›è¡Œä¸­ |
| v1.1 | `[no-any-return]`, `[no-untyped-def]` | < 50 | å¾…å¼€å§‹ |
| v1.2 | `src/engram/logbook/` æ ¸å¿ƒæ¨¡å— (cursor, outbox, governance) | < 30 | ğŸ“‹ è¿›è¡Œä¸­ |
| v1.3 | `[import-untyped]` | < 20 | å¾…å¼€å§‹ |
| v1.4 | é«˜é£é™©æ¨¡å—: `di.py`, `container.py`, `migrate.py` | < 10 | å¾…å¼€å§‹ |
| v2.0 | å…¨é‡ strict | 0 | å¾…å¼€å§‹ |

---

## éªŒæ”¶è®°å½•

### è¿­ä»£ YYYY-MM-DDï¼ˆæ¨¡æ¿ç¤ºä¾‹ï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **æ—¥æœŸ** | YYYY-MM-DD |
| **Commit** | `abc1234...` |
| **ç¯å¢ƒ** | macOS 14.x / Docker 24.x / PostgreSQL 18.x |
| **æ‰§è¡Œå‘½ä»¤** | è§ä¸‹æ–¹ |
| **ç»“æœ** | PASS / PARTIAL / FAIL |

**æ‰§è¡Œå‘½ä»¤**:

```bash
# 1. éƒ¨ç½²
make deploy

# 2. ç»Ÿä¸€æ ˆéªŒè¯
make verify-unified

# 3. Logbook å†’çƒŸæµ‹è¯•
make logbook-smoke

# 4. å•å…ƒæµ‹è¯•
make test-logbook-unit

# 5. é›†æˆæµ‹è¯•
make test-gateway-integration
```

**å·²çŸ¥é™åˆ¶**:

- [ç¤ºä¾‹] SCM åŒæ­¥ä»…æ”¯æŒ GitLabï¼ŒGitHub æ”¯æŒå¾…å¼€å‘

**æœªè¦†ç›–èŒƒå›´**:

| æµ‹è¯•ç±»å‹ | æœªè¦†ç›–é¡¹ | åŸå›  | é£é™©ç­‰çº§ |
|----------|----------|------|----------|
| [ç¤ºä¾‹] æ€§èƒ½æµ‹è¯• | å¤§è§„æ¨¡æ•°æ®å‹æµ‹ | ç¯å¢ƒé™åˆ¶ | ä¸­ |
| [ç¤ºä¾‹] å®‰å…¨æµ‹è¯• | æ¸—é€æµ‹è¯• | éœ€ä¸“ä¸šå›¢é˜Ÿ | é«˜ |

**é£é™©è¯„ä¼°**:

- **é«˜é£é™©**: [ç¤ºä¾‹] æœªæ‰§è¡Œæ¸—é€æµ‹è¯•ï¼Œç”Ÿäº§éƒ¨ç½²å‰éœ€å®‰æ’å®‰å…¨å®¡è®¡
- **ä¸­é£é™©**: [ç¤ºä¾‹] æœªè¿›è¡Œå¤§è§„æ¨¡å‹æµ‹ï¼Œé«˜å¹¶å‘åœºæ™¯å¯èƒ½å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ

---

### è¿­ä»£ 2026-01-30ï¼ˆå½“å‰ï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **æ—¥æœŸ** | 2026-01-30 |
| **Commit** | `4d5d607` |
| **ç¯å¢ƒ** | macOS 15.7.3 / Darwin 24.6.0 (arm64) / Docker N/A / PostgreSQL N/A |
| **æ‰§è¡Œå‘½ä»¤** | è§ä¸‹æ–¹ |
| **ç»“æœ** | **PASS** |
| **éªŒæ”¶è®°å½•** | `.artifacts/acceptance-runs/20260130T000804Z_acceptance-logbook-only.json`ï¼ˆæœ¬åœ°æ‰§è¡Œè®°å½•ï¼Œcommit `4d5d607`ï¼‰ |

**æ‰§è¡Œå‘½ä»¤**:

```bash
# Logbook-only åˆ†æ­¥éªŒæ”¶ï¼ˆæ ‡å‡†æ­¥éª¤ï¼‰
make up-logbook                    # 1. å¯åŠ¨ Logbook æœåŠ¡
make migrate-logbook-stepwise      # 2. æ•°æ®åº“è¿ç§»
make verify-permissions-logbook    # 3. æƒé™éªŒè¯ï¼ˆLogbook-onlyï¼‰
make logbook-smoke                 # 4. å†’çƒŸæµ‹è¯•
make test-logbook-unit             # 5. å•å…ƒæµ‹è¯•

# æˆ–ä¸€é”®éªŒæ”¶
make acceptance-logbook-only
```

**æœ¬æ¬¡å®é™…æ‰§è¡Œ**:

```bash
# 1. Logbook éƒ¨ç½²é…ç½®ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæ— éœ€ Dockerï¼‰
python scripts/verify_logbook_consistency.py --verbose

# 2. Makefile acceptance-logbook-only æ­¥éª¤åºåˆ—éªŒè¯
#    éªŒè¯æ­¥éª¤: up-logbook â†’ migrate-logbook-stepwise â†’ verify-permissions-logbook â†’ logbook-smoke â†’ test-logbook-unit

# 3. compose/logbook.yml æœ€å° .env å…¼å®¹æ€§æ£€æŸ¥
```

**éªŒè¯ç»“æœæ‘˜è¦**:

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| A) initdb é»˜è®¤ç¯å¢ƒ | PASS | compose/logbook.yml åœ¨ç¼ºçœ .env ä¸‹ä¸ä¼šè‡´å‘½å¤±è´¥ |
| B) acceptance compose ä¾èµ– | PASS | å­ç›®æ ‡æ­£ç¡®ä½¿ç”¨ LOGBOOK_COMPOSEï¼ˆlogbook-smoke æ”¯æŒåŒæ£€æµ‹ï¼‰ |
| C) Makefile ä¸€è‡´æ€§ | PASS | up-logbook æè¿°ä¸å®ç°ä¸€è‡´ |

**å·²çŸ¥é™åˆ¶**:

- å½“å‰ç¯å¢ƒæ—  Dockerï¼Œæ— æ³•æ‰§è¡Œå®Œæ•´å®¹å™¨çº§éªŒæ”¶
- logbook-smoke éœ€è¦ PostgreSQL æœåŠ¡è¿è¡Œ
- æ–‡æ¡£é‡æ„è¿­ä»£ï¼Œæ ¸å¿ƒé€»è¾‘æœªå˜æ›´

**æœ¬æ¬¡ä¿®å¤**:

1. **Makefile `logbook-smoke`**: ä¿®å¤äº†å®¹å™¨çŠ¶æ€æ£€æŸ¥é€»è¾‘ï¼Œç°åœ¨åŒæ—¶æ”¯æŒ Logbook-only éƒ¨ç½²ï¼ˆ`$(LOGBOOK_COMPOSE)`ï¼‰å’Œç»Ÿä¸€æ ˆéƒ¨ç½²ï¼ˆ`$(DOCKER_COMPOSE)`ï¼‰
2. **verify_logbook_consistency.py**: æ›´æ–°æ£€æŸ¥é€»è¾‘ï¼Œæ¥å—"åŒæ£€æµ‹æ¨¡å¼"ä½œä¸ºæœ‰æ•ˆé…ç½®

**æœªè¦†ç›–èŒƒå›´**:

| æµ‹è¯•ç±»å‹ | æœªè¦†ç›–é¡¹ | åŸå›  | é£é™©ç­‰çº§ |
|----------|----------|------|----------|
| å®¹å™¨éªŒæ”¶ | `make acceptance-logbook-only` | å½“å‰ç¯å¢ƒæ—  Docker | ä¸­ |
| å†’çƒŸæµ‹è¯• | `make logbook-smoke` | éœ€è¦ PostgreSQL æœåŠ¡ | ä¸­ |
| æƒé™éªŒè¯ | `make verify-permissions-logbook` | éœ€è¦ PostgreSQL æœåŠ¡ | ä½ |

**é£é™©è¯„ä¼°**:

- **ä¸­é£é™©**: æœªæ‰§è¡Œå®Œæ•´å®¹å™¨çº§éªŒæ”¶ï¼Œéœ€åœ¨ Docker ç¯å¢ƒä¸­è¡¥å……æ‰§è¡Œ
- **ä½é£é™©**: æ ¸å¿ƒé…ç½®ä¸€è‡´æ€§å·²é€šè¿‡é™æ€æ£€æŸ¥éªŒè¯

**è‡ªåŠ¨è®°å½•è„šæœ¬**:

å¦‚éœ€æ‰‹åŠ¨ç”ŸæˆéªŒæ”¶è®°å½• JSONï¼Œå¯ä½¿ç”¨ï¼š

```bash
python3 scripts/acceptance/record_acceptance_run.py \
    --name acceptance-logbook-only \
    --artifacts-dir .artifacts/acceptance-logbook-only \
    --result PARTIAL \
    --commit 4d5d607
```

è®°å½•å°†ä¿å­˜è‡³ `.artifacts/acceptance-runs/<timestamp>_acceptance-logbook-only.json`

---

### è¿­ä»£ 2026-01-30ï¼ˆUnified æœ€å°éªŒæ”¶è§„èŒƒç¡®è®¤ï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **æ—¥æœŸ** | 2026-01-30 |
| **Commit** | `4d5d607` (åŒä¸Š) |
| **ç¯å¢ƒ** | macOS Darwin 24.6.0 (x86_64) / Docker N/A |
| **æ‰§è¡Œå‘½ä»¤** | è§ä¸‹æ–¹ |
| **ç»“æœ** | **PASS** |
| **éªŒæ”¶è®°å½•** | `.artifacts/acceptance-runs/20260130T000805Z_acceptance-unified-min.json`ï¼ˆæœ¬åœ°æ‰§è¡Œè®°å½•ï¼Œcommit `4d5d607`ï¼‰ |

**æ‰§è¡Œå‘½ä»¤**ï¼ˆacceptance-unified-min æ­¥éª¤ï¼‰:

```bash
# acceptance-unified-min å®Œæ•´æ­¥éª¤åºåˆ—
# 1. éƒ¨ç½²ç»Ÿä¸€æ ˆï¼ˆå¯é€šè¿‡ SKIP_DEPLOY=1 è·³è¿‡ï¼‰
make deploy

# 2. ç»Ÿä¸€æ ˆéªŒè¯ï¼ˆHTTP_ONLY_MODE=1ï¼Œæ— éœ€ Docker å®¹å™¨æ“ä½œæƒé™ï¼‰
HTTP_ONLY_MODE=1 make verify-unified

# 3. Logbook å•å…ƒæµ‹è¯•
make test-logbook-unit

# 4. Gateway é›†æˆæµ‹è¯•ï¼ˆHTTP_ONLY_MODE=1ï¼‰
HTTP_ONLY_MODE=1 make test-gateway-integration
```

**è§„èŒƒéªŒè¯å†…å®¹**:

æœ¬æ¬¡è¿­ä»£éªŒè¯äº† `acceptance-unified-min` çš„è§„èŒƒå®šä¹‰ä¸æ–‡æ¡£ä¸€è‡´æ€§ï¼š

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| Makefile ç›®æ ‡å®šä¹‰ | PASS | `acceptance-unified-min` æ­£ç¡®å®šä¹‰æ­¥éª¤åºåˆ— |
| HTTP_ONLY_MODE ä¼ é€’ | PASS | verify-unified å’Œ test-gateway-integration æ­£ç¡®æ¥æ”¶ HTTP_ONLY_MODE=1 |
| äº§å‡ºç›®å½• | PASS | `.artifacts/acceptance-unified-min/` å’Œ `.artifacts/verify-results.json` |
| æ–‡æ¡£ä¸€è‡´æ€§ | PASS | README.md å’Œ integrate_existing_project.md å‚æ•°æ˜ å°„ä¸€è‡´ |

**acceptance-unified-min ä¸ acceptance-unified-full å¯¹æ¯”**:

| ç‰¹æ€§ | acceptance-unified-min | acceptance-unified-full |
|------|------------------------|-------------------------|
| **é€‚ç”¨åœºæ™¯** | CI PR å¿«é€ŸéªŒè¯ | Nightly/å‘å¸ƒå‰å®Œæ•´éªŒæ”¶ |
| **Docker å®¹å™¨æ“ä½œ** | ä¸éœ€è¦ï¼ˆHTTP_ONLY_MODE=1ï¼‰ | éœ€è¦ï¼ˆé™çº§æµ‹è¯•æ“ä½œå®¹å™¨ï¼‰ |
| **VERIFY_FULL** | *(ä¸è®¾ç½®)* | **1**ï¼ˆå®Œæ•´éªŒè¯æ¨¡å¼ï¼‰ |
| **HTTP_ONLY_MODE** | **1**ï¼ˆæ˜¾å¼è®¾ç½®ï¼‰ | **0**ï¼ˆæ˜¾å¼è®¾ç½®ï¼Œå…è®¸ Docker æ“ä½œï¼‰ |
| **SKIP_DEGRADATION_TEST** | **1**ï¼ˆæ˜¾å¼è®¾ç½®ï¼‰ | **0**ï¼ˆæ˜¾å¼è®¾ç½®ï¼Œæ‰§è¡Œé™çº§æµ‹è¯•ï¼‰ |
| **GATE_PROFILE** | http_only | **full** |
| **é™çº§æµ‹è¯•** | è·³è¿‡ | æ‰§è¡Œ |
| **logbook-smoke** | è·³è¿‡ | æ‰§è¡Œ |
| **Gateway é›†æˆæµ‹è¯•** | test-gateway-integration | **test-gateway-integration-full** |
| **MinIO** | ä¸éœ€è¦ | ä¸éœ€è¦ |
| **æ‰§è¡Œæ—¶é—´** | ~2-5 åˆ†é’Ÿ | ~5-10 åˆ†é’Ÿ |
| **äº§å‡ºæ–‡ä»¶** | steps.log, summary.json | steps.log, summary.json, verify-results.json |

> **ç¯å¢ƒå˜é‡ä¼ é€’æ–¹å¼**: Makefile ä¸­è¿™äº›å˜é‡åœ¨è°ƒç”¨å­ç›®æ ‡æ—¶ä½œä¸ºå‰ç¼€æ˜¾å¼ä¼ é€’ï¼ˆå¦‚ `HTTP_ONLY_MODE=1 $(MAKE) verify-unified`ï¼‰ï¼Œ
> è€Œéä»…ä¾èµ– shell `export`ï¼Œç¡®ä¿å­ make è¿›ç¨‹æ­£ç¡®æ¥æ”¶å€¼ã€‚

**å·²çŸ¥é™åˆ¶**:

- å½“å‰ç¯å¢ƒæ—  Dockerï¼Œæ— æ³•æ‰§è¡Œå®Œæ•´å®¹å™¨çº§éªŒæ”¶
- æ–‡æ¡£ä¸è§„èŒƒä¸€è‡´æ€§å·²éªŒè¯ï¼Œå®é™…æ‰§è¡Œå¾… Docker ç¯å¢ƒè¡¥å……

**æœªè¦†ç›–èŒƒå›´**:

| æµ‹è¯•ç±»å‹ | æœªè¦†ç›–é¡¹ | åŸå›  | é£é™©ç­‰çº§ |
|----------|----------|------|----------|
| å®¹å™¨æ‰§è¡Œ | `make acceptance-unified-min` å®é™…è¿è¡Œ | å½“å‰ç¯å¢ƒæ—  Docker | ä¸­ |
| ç«¯åˆ°ç«¯éªŒè¯ | HTTP å¥åº·æ£€æŸ¥ã€MCP å·¥å…·è°ƒç”¨ | éœ€è¦æœåŠ¡è¿è¡Œ | ä¸­ |

**é£é™©è¯„ä¼°**:

- **ä¸­é£é™©**: è§„èŒƒéªŒè¯é€šè¿‡ä½†æœªå®é™…æ‰§è¡Œï¼Œéœ€åœ¨ Docker ç¯å¢ƒä¸­è¡¥å……æ‰§è¡Œ
- **ä½é£é™©**: Makefile ç›®æ ‡ä¸æ–‡æ¡£å®šä¹‰ä¸€è‡´ï¼Œè§„èŒƒå±‚é¢æ— é—®é¢˜

---

## Gateway â†’ Logbook è¦†ç›–ç‚¹

### æµ‹è¯•æ–‡ä»¶

ä¸»è¦æµ‹è¯•æ–‡ä»¶ï¼š`tests/gateway/test_unified_stack_integration.py`

### è¦†ç›–ç‚¹æ˜ç»†è¡¨

| è¦†ç›–ç‚¹ | æµ‹è¯•ç±» | å‰ç½®æ¡ä»¶ | HTTP_ONLY_MODE è¡Œä¸º |
|--------|--------|----------|---------------------|
| Gateway å¥åº·æ£€æŸ¥ | `TestServiceHealthCheck` | `RUN_INTEGRATION_TESTS=1`ã€Gateway è¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| OpenMemory å¥åº·æ£€æŸ¥ | `TestServiceHealthCheck` | `RUN_INTEGRATION_TESTS=1`ã€OpenMemory è¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| PostgreSQL è¿æ¥éªŒè¯ | `TestServiceHealthCheck` | `POSTGRES_DSN` ç¯å¢ƒå˜é‡ | æ­£å¸¸è¿è¡Œ |
| memory_store å†™å…¥ | `TestMemoryOperations` | `RUN_INTEGRATION_TESTS=1`ã€ç»Ÿä¸€æ ˆè¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| memory_query æŸ¥è¯¢ | `TestMemoryOperations` | `RUN_INTEGRATION_TESTS=1`ã€ç»Ÿä¸€æ ˆè¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| å¸¦å…ƒæ•°æ®çš„ memory_store | `TestMemoryOperations` | `RUN_INTEGRATION_TESTS=1`ã€ç»Ÿä¸€æ ˆè¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| å­˜å‚¨-æŸ¥è¯¢å¾€è¿”æµ‹è¯• | `TestEndToEndFlow` | `RUN_INTEGRATION_TESTS=1`ã€ç»Ÿä¸€æ ˆè¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| **çœŸå®é™çº§æµç¨‹** | `TestDegradationFlow` | Docker å®¹å™¨æ“ä½œæƒé™ã€`POSTGRES_DSN` | **è·³è¿‡** |
| Mock é™çº§æµç¨‹ | `TestMockDegradationFlow` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| Mock æŸ¥è¯¢é™çº§ | `TestMockQueryDegradation` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| å¯é æ€§æŠ¥å‘Šç«¯ç‚¹ | `TestReliabilityReport` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| OpenMemory DB è§’è‰²æƒé™ | `TestOpenMemoryDbRoles` | `POSTGRES_DSN`ã€`OM_PG_SCHEMA` | æ­£å¸¸è¿è¡Œ |
| å¯åŠ¨éªŒè¯é”™è¯¯ä¿¡æ¯ | `TestStartupVerificationErrors` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| æ•°æ®åº“è§’è‰²éªŒè¯ | `TestDatabaseRolesVerification` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| MCP memory_store E2E | `TestMCPMemoryStoreE2E` | `POSTGRES_DSN`ã€ç»Ÿä¸€æ ˆè¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| MCP Mock é™çº§æµ‹è¯• | `TestMCPMemoryStoreWithMockDegradation` | `POSTGRES_DSN` | æ­£å¸¸è¿è¡Œ |
| **Outbox Worker çœŸå®é›†æˆ** | `TestOutboxWorkerRealIntegration` | Docker æƒé™ã€`POSTGRES_DSN` | **è·³è¿‡** |
| JSON-RPC 2.0 åè®® | `TestJsonRpcProtocol` | `RUN_INTEGRATION_TESTS=1`ã€Gateway è¿è¡Œ | æ­£å¸¸è¿è¡Œ |
| æ—§åè®®å…¼å®¹æ€§ | `TestLegacyProtocol` | `RUN_INTEGRATION_TESTS=1`ã€Gateway è¿è¡Œ | æ­£å¸¸è¿è¡Œ |

### è¿è¡Œæ¨¡å¼

| Makefile ç›®æ ‡ | ç¯å¢ƒå˜é‡ | è¯´æ˜ |
|---------------|----------|------|
| `make test-gateway-integration` | `HTTP_ONLY_MODE=1` | çº¯ HTTP éªŒè¯ï¼ŒCI æ¨èï¼Œè·³è¿‡éœ€è¦ Docker æ“ä½œçš„æµ‹è¯• |
| `make test-gateway-integration-full` | æ—  `HTTP_ONLY_MODE` | å®Œæ•´é›†æˆæµ‹è¯•ï¼Œå«é™çº§æµ‹è¯•ï¼Œéœ€è¦ Docker æƒé™ |

### å¿…éœ€ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `RUN_INTEGRATION_TESTS` | å¯ç”¨é›†æˆæµ‹è¯• | å¿…é¡»è®¾ä¸º `1` |
| `GATEWAY_URL` | Gateway æœåŠ¡ URL | `http://localhost:8787` |
| `OPENMEMORY_URL` | OpenMemory æœåŠ¡ URL | `http://localhost:8080` |
| `POSTGRES_DSN` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | æ— é»˜è®¤å€¼ï¼Œéƒ¨åˆ†æµ‹è¯•ä¼šè·³è¿‡ |

### å¯é€‰ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ |
|------|------|
| `HTTP_ONLY_MODE=1` | ä»…è¿è¡Œçº¯ HTTP éªŒè¯æµ‹è¯•ï¼ˆè·³è¿‡ Docker æ“ä½œï¼‰ |
| `SKIP_DEGRADATION_TEST=1` | è·³è¿‡é™çº§æµ‹è¯• |
| `OM_PG_SCHEMA` | OpenMemory ç›®æ ‡ schemaï¼ˆé»˜è®¤ `openmemory`ï¼‰ |

---

**æœªè¦†ç›–èŒƒå›´**:

| æµ‹è¯•ç±»å‹ | æœªè¦†ç›–é¡¹ | åŸå›  | é£é™©ç­‰çº§ |
|----------|----------|------|----------|
| MinIO é›†æˆæµ‹è¯• | `test_object_store_minio_integration.py` | éœ€è¦ MinIO æœåŠ¡è¿è¡Œï¼ˆ`docker-compose.minio.yml`ï¼‰ | ä¸­ |
| å¯¹è±¡å­˜å‚¨å®¡è®¡é—­ç¯ | ç”Ÿäº§ç¯å¢ƒ S3/MinIO å®¡è®¡äº‹ä»¶ç«¯åˆ°ç«¯éªŒè¯ | éœ€è¦çœŸå®å¯¹è±¡å­˜å‚¨é…ç½®ä¸å®¡è®¡ Webhook | é«˜ |
| SCM åŒæ­¥æµ‹è¯• | GitLab/SVN å®é™…åŒæ­¥ | éœ€è¦å¤–éƒ¨ SCM æœåŠ¡ä¸å‡­æ®é…ç½® | ä¸­ |
| æ€§èƒ½æµ‹è¯• | å¤§è§„æ¨¡æ•°æ®å‹æµ‹ | å½“å‰è¿­ä»£ä¸æ¶‰åŠæ€§èƒ½å˜æ›´ | ä½ |

**é£é™©è¯„ä¼°**:

- **é«˜é£é™©**: ç”Ÿäº§å¯¹è±¡å­˜å‚¨å®¡è®¡é—­ç¯æœªéªŒè¯ï¼ŒArtifact å†™å…¥ä¸å®¡è®¡äº‹ä»¶ä¸€è‡´æ€§ä¾èµ–äººå·¥ç¡®è®¤
- **ä¸­é£é™©**: MinIO é›†æˆæµ‹è¯•éœ€æœ¬åœ° MinIOï¼ŒCI ç¯å¢ƒæš‚ä¸åŒ…å«
- **ä¸­é£é™©**: SCM åŒæ­¥åŠŸèƒ½ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œæœ¬åœ°æµ‹è¯•è¦†ç›–æœ‰é™
- **ä½é£é™©**: æœ¬è¿­ä»£ä¸»è¦ä¸ºå‘½åé‡æ„ä¸æ–‡æ¡£å®Œå–„ï¼Œæ ¸å¿ƒé€»è¾‘å˜æ›´å°

**åç»­æ”¹è¿›è®¡åˆ’**:

1. CI æ·»åŠ  MinIO sidecar æ”¯æŒ `test_object_store_minio_integration.py`
2. å»ºç«‹ SCM åŒæ­¥ mock æµ‹è¯•è¦†ç›– GitLab/SVN æ ¸å¿ƒè·¯å¾„
3. è®¾è®¡å¯¹è±¡å­˜å‚¨å®¡è®¡ç«¯åˆ°ç«¯éªŒè¯è„šæœ¬ï¼ˆ`scripts/ops/verify_bucket_governance.py`ï¼‰

---

## éªŒæ”¶æµ‹è¯•å‘½ä»¤å‚è€ƒ

### Logbook ç‹¬ç«‹éªŒæ”¶ï¼ˆä»…äº‹å®è´¦æœ¬ï¼‰

```bash
make acceptance-logbook-only
```

**é€‚ç”¨åœºæ™¯**:
- ä»…éœ€ PostgreSQL äº‹å®è´¦æœ¬ï¼Œä¸éœ€è¦ OpenMemory è¯­ä¹‰è®°å¿†
- CI/CD ä¸­å¿«é€ŸéªŒè¯ Logbook æ ¸å¿ƒåŠŸèƒ½
- å¼€å‘ç¯å¢ƒ Logbook ç»„ä»¶ç‹¬ç«‹è°ƒè¯•

**æ‰§è¡Œæ­¥éª¤**: up-logbook â†’ migrate-logbook-stepwise â†’ verify-permissions-logbook â†’ logbook-smoke â†’ test-logbook-unit

**ç¯å¢ƒå˜é‡**:

| å˜é‡ | è¯´æ˜ |
|------|------|
| `SKIP_DEPLOY=1` | è·³è¿‡ up-logbookï¼ˆå¤ç”¨å·²æœ‰ PostgreSQLï¼‰ |
| `SKIP_MIGRATE=1` | è·³è¿‡è¿ç§»ï¼ˆSchema å·²å­˜åœ¨ï¼‰ |
| `ENGRAM_VERIFY_GATE=off` | è·³è¿‡æƒé™éªŒè¯ï¼ˆæ›¿ä»£å·²ç§»é™¤çš„ `SKIP_VERIFY_PERMISSIONS`ï¼‰ |

> **æ³¨æ„**ï¼š`SKIP_VERIFY_PERMISSIONS=1` å·²ç§»é™¤ï¼ˆæ— å®é™…å®ç°ï¼‰ã€‚å¦‚éœ€è·³è¿‡æƒé™éªŒè¯ï¼Œè¯·ä½¿ç”¨ `ENGRAM_VERIFY_GATE=off` æˆ– `--verify-gate=off`ã€‚

**äº§å‡º**: `.artifacts/acceptance-logbook-only/`ï¼ˆsummary.jsonã€steps.logã€health.jsonã€test-results-index.jsonã€diagnostics/ï¼‰

### æœ€å°éªŒæ”¶ï¼ˆCI PR æ¨èï¼‰

```bash
make acceptance-unified-min
```

åŒ…å«: éƒ¨ç½² â†’ verify-unified â†’ test-logbook-unit â†’ test-gateway-integration

**ç¯å¢ƒè¯­ä¹‰ï¼ˆå›ºå®šï¼‰**:
- `HTTP_ONLY_MODE=1`
- `SKIP_DEGRADATION_TEST=1`
- `GATE_PROFILE=http_only`

**äº§å‡º**: `.artifacts/acceptance-unified-min/`ï¼ˆsummary.jsonã€steps.logã€verify-results.jsonã€test-results-index.jsonã€diagnostics/ï¼‰

### å®Œæ•´éªŒæ”¶ï¼ˆNightly/å‘å¸ƒå‰æ¨èï¼‰

```bash
make acceptance-unified-full
```

åŒ…å«: éƒ¨ç½² â†’ logbook-smoke â†’ verify-unifiedï¼ˆVERIFY_FULL=1ï¼‰â†’ test-logbook-unit â†’ test-gateway-integration-full

**FULL è¯­ä¹‰ï¼ˆå›ºå®šï¼‰**:

- `VERIFY_FULL=1`ï¼ˆå®Œæ•´éªŒè¯æ¨¡å¼ï¼‰
- `HTTP_ONLY_MODE=0`ï¼ˆå…è®¸ Docker æ“ä½œï¼‰
- `SKIP_DEGRADATION_TEST=0`ï¼ˆæ‰§è¡Œé™çº§æµ‹è¯•ï¼‰
- `GATE_PROFILE=full`

**äº§å‡º**: `.artifacts/acceptance-unified-full/`ï¼ˆsteps.logã€summary.jsonã€verify-results.jsonã€test-results-index.jsonã€diagnostics/ï¼‰

### CI æœŸæœ›è¦†ç›–è¡¨

> **å•ä¸€æ¥æº**: `.github/workflows/ci.yml` å’Œ `.github/workflows/nightly.yml`

æœ¬è¡¨è®°å½• CI/Nightly å·¥ä½œæµçš„æœŸæœ›è¦†ç›–èŒƒå›´ï¼Œä¸ Makefile acceptance ç›®æ ‡çš„æ˜ å°„å…³ç³»ã€‚

#### CI è¦†ç›–æ¨¡å¼è¯´æ˜

CI å·¥ä½œæµä¸­çš„ `unified-standard` job é‡‡ç”¨ **ç»„åˆå¼è¦†ç›–** ç­–ç•¥ï¼š
- **ä¸ç›´æ¥æ‰§è¡Œ** `make acceptance-unified-min`
- è€Œæ˜¯åœ¨ workflow ä¸­ **åˆ†æ­¥æ‰§è¡Œ** acceptance-unified-min çš„æ ¸å¿ƒæ­¥éª¤
- è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†æ”¯æŒï¼šç»†ç²’åº¦çš„æ¡ä»¶æ£€æŸ¥ã€ç‹¬ç«‹çš„ artifact æ”¶é›†ã€çµæ´»çš„é”™è¯¯å¤„ç†

**ç»„åˆå¼è¦†ç›– vs çœŸå®æ‰§è¡Œ**ï¼š

| ç‰¹æ€§ | CI ç»„åˆå¼è¦†ç›– | æœ¬åœ° `make acceptance-unified-min` |
|------|--------------|-----------------------------------|
| æ‰§è¡Œæ–¹å¼ | workflow åˆ†æ­¥æ‰§è¡Œ | Makefile å•å‘½ä»¤æ‰§è¡Œ |
| æ­¥éª¤æ§åˆ¶ | å¯æŒ‰æ¡ä»¶è·³è¿‡æŸäº›æ­¥éª¤ | å›ºå®šæ­¥éª¤åºåˆ— |
| artifact æ”¶é›† | æ¯æ­¥ç‹¬ç«‹ä¸Šä¼  | ç»Ÿä¸€æ”¶é›†åˆ° `.artifacts/acceptance-unified-min/` |
| å¤±è´¥å¤„ç† | å¯ continue-on-error | å¤±è´¥ç«‹å³é€€å‡º |
| record_acceptance_run | æ˜¾å¼è°ƒç”¨ï¼Œä¼ å…¥ metadata | è‡ªåŠ¨è°ƒç”¨ |

#### CI å·¥ä½œæµè¦†ç›–ï¼ˆci.ymlï¼‰

| Profile | è§¦å‘æ¡ä»¶ | è¦†ç›–è¯­ä¹‰ | è¦†ç›–èŒƒå›´ | Capability è¦æ±‚ |
|---------|----------|----------|----------|-----------------|
| **http_only** | PR å˜æ›´æ£€æµ‹è§¦å‘ | `acceptance-unified-min` ç»„åˆå¼è¦†ç›– | å¥åº·æ£€æŸ¥ã€memory_storeã€memory_query | Dockerã€PostgreSQL |

**CI Matrix ç­–ç•¥**ï¼š
- å½“å‰å¯ç”¨ profile: `[http_only]`
- å¯æ‰©å±•: `[http_only, standard]`ï¼ˆstandard å« JSON-RPC éªŒè¯ï¼‰

**CI è¦†ç›–æ­¥éª¤**ï¼ˆç»„åˆå¼è¦†ç›– acceptance-unified-minï¼‰ï¼š

| æ­¥éª¤ | http_only Profile | å¯¹åº” acceptance-unified-min æ­¥éª¤ | è¯´æ˜ |
|------|-------------------|----------------------------------|------|
| deploy | âœ… | Step 1: deploy | å¯åŠ¨ç»Ÿä¸€æ ˆ |
| verify-unified | âœ… (HTTP_ONLY_MODE=1) | Step 2: verify-unified | è·³è¿‡ MCP JSON-RPC |
| test-logbook-unit | âœ… | Step 3: test-logbook-unit | Logbook å•å…ƒæµ‹è¯• |
| test-gateway-integration | âœ… (HTTP_ONLY_MODE=1) | Step 4: test-gateway-integration | è·³è¿‡é™çº§æµ‹è¯• |
| record_acceptance_run.py | âœ… | è®°å½•æ­¥éª¤ | è®°å½•éªŒæ”¶è¿è¡Œï¼ˆå« CI metadataï¼‰ |

#### Nightly å·¥ä½œæµè¦†ç›–ï¼ˆnightly.ymlï¼‰

| æ‰§è¡Œæ–¹å¼ | è§¦å‘æ¡ä»¶ | è¦†ç›–èŒƒå›´ | Capability è¦æ±‚ |
|----------|----------|----------|-----------------|
| **ç›´æ¥æ‰§è¡Œ** `make acceptance-unified-full` | schedule æˆ– workflow_dispatch | å®Œæ•´éªŒæ”¶ï¼ˆå«é™çº§æµ‹è¯•ï¼‰ | Dockerã€PostgreSQLã€POSTGRES_DSN |

> **æ¶æ„è¯´æ˜ï¼ˆv1.11.0+ï¼‰**: Nightly å·¥ä½œæµ **ç›´æ¥è°ƒç”¨** `make acceptance-unified-full`ï¼ˆéç»„åˆå¼è¦†ç›–ï¼‰ã€‚
> æ ¸å¿ƒéªŒè¯é“¾ï¼ˆverify-unified + gateway-integrationï¼‰å·²æ”¶æ•›åˆ° `acceptance-unified-full` å†…éƒ¨æ‰§è¡Œï¼Œ
> nightly.yml ä¸å†ç‹¬ç«‹è¿è¡Œè¿™äº›æ­¥éª¤ã€‚MinIO/Build æµ‹è¯•ä¿æŒä¸ºé¢å¤–æµ‹è¯•ã€‚

**Nightly å®Œæ•´è¦†ç›–æ­¥éª¤**ï¼ˆç”± `make acceptance-unified-full` å†…éƒ¨æ‰§è¡Œï¼‰ï¼š

| æ­¥éª¤ | acceptance-unified-full å†…éƒ¨æ­¥éª¤ | è¯´æ˜ |
|------|----------------------------------|------|
| deploy | Step 1 | å¯åŠ¨ç»Ÿä¸€æ ˆï¼ˆSKIP_DEPLOY=1 å¯è·³è¿‡ï¼‰ |
| logbook-smoke | Step 2 | Logbook å†’çƒŸæµ‹è¯• |
| verify-unified | Step 3 (VERIFY_FULL=1, HTTP_ONLY_MODE=0) | å®Œæ•´éªŒè¯ï¼ˆå«é™çº§æµ‹è¯•ï¼‰ |
| test-logbook-unit | Step 4 | Logbook å•å…ƒæµ‹è¯• |
| test-gateway-integration-full | Step 5 | å®Œæ•´é›†æˆæµ‹è¯•ï¼ˆå«çœŸå®é™çº§æµ‹è¯•ï¼‰ |
| record_acceptance_run.py | è‡ªåŠ¨è°ƒç”¨ | è®°å½•éªŒæ”¶è¿è¡Œï¼ˆå¤±è´¥æ—¶ä»æ‰§è¡Œï¼‰ |

**Nightly é¢å¤–æµ‹è¯•**ï¼ˆç‹¬ç«‹äº acceptance-unified-fullï¼‰ï¼š

| æµ‹è¯• | è¯´æ˜ |
|------|------|
| Logbook Integration (MinIO) | MinIO å¯¹è±¡å­˜å‚¨é›†æˆæµ‹è¯• |
| Seek PGVector Integration | PGVector å‘é‡æ£€ç´¢æµ‹è¯• |
| Seek Migrate (dry-run) | è¿ç§»è„šæœ¬éªŒè¯ |
| Seek Smoke Test | ç´¢å¼•/æ£€ç´¢/ä¸€è‡´æ€§æ£€æŸ¥ |
| Seek Nightly Rebuild | æ ‡å‡†åŒ–ç´¢å¼•é‡å»º |
| Seek Dual-Read | primary/shadow ä¸€è‡´æ€§ |
| Seek Migration Drill | è¿ç§»æ¼”ç»ƒé›†æˆæµ‹è¯• |
| Artifact Audit | åˆ¶å“ä¸€è‡´æ€§å®¡è®¡ |
| Docker Build | å®Œæ•´ Docker æ„å»ºéªŒè¯ |

#### CI/Nightly ä¸ Profile æ˜ å°„

| Workflow | Profile | HTTP_ONLY_MODE | SKIP_DEGRADATION_TEST | VERIFY_FULL | GATE_PROFILE |
|----------|---------|----------------|----------------------|-------------|--------------|
| ci.yml (PR) | http_only | **1** | **1** | *(ä¸è®¾ç½®)* | http_only |
| nightly.yml | full | **0** | **0** | **1** | full |

> **é‡è¦**: CI/Nightly workflow ä¸­çš„ç¯å¢ƒå˜é‡è®¾ç½®å¿…é¡»ä¸ Makefile acceptance targets çš„æ˜¾å¼è®¾ç½®ä¿æŒä¸€è‡´ã€‚
> é™æ€æ£€æŸ¥è„šæœ¬ `scripts/ci/check_env_consistency.py` ä¼šè‡ªåŠ¨æ ¡éªŒè¿™äº›å€¼çš„ä¸€è‡´æ€§ã€‚

#### äº§ç‰©è®°å½•ä¸è¿½æº¯

æ‰€æœ‰ acceptance è¿è¡Œé€šè¿‡ `scripts/acceptance/record_acceptance_run.py` è®°å½•ï¼š

| Workflow | äº§ç‰©ç›®å½• | å…³é”®äº§ç‰© | è®°å½•æ–‡ä»¶ | ä¿ç•™å¤©æ•° |
|----------|----------|----------|----------|----------|
| ci.yml | `.artifacts/acceptance-unified-min/` | `summary.json`, `steps.log`, `verify-results.json` | `.artifacts/acceptance-runs/<timestamp>_acceptance-unified-min.json` | 30 |
| nightly.yml | `.artifacts/acceptance-unified-full/` | `summary.json`, `steps.log`, `verify-results.json` | `.artifacts/acceptance-runs/<timestamp>_acceptance-unified-full.json` | 30 |

#### å®ç°äº§ç‰©æ¸…å•

éªŒæ”¶æµ‹è¯•æ‰§è¡Œåç”Ÿæˆçš„äº§ç‰©æ–‡ä»¶è¯´æ˜ï¼š

| äº§ç‰©æ–‡ä»¶ | ç”Ÿæˆæ–¹å¼ | å†…å®¹è¯´æ˜ |
|----------|----------|----------|
| `summary.json` | Makefile acceptance target ç”Ÿæˆ | éªŒæ”¶æ‘˜è¦ï¼šnameã€resultã€ç¯å¢ƒå˜é‡ã€è€—æ—¶ |
| `steps.log` | Makefile acceptance target ç”Ÿæˆ | å„æ­¥éª¤æ‰§è¡Œæ—¥å¿—ï¼ˆå«æ—¶é—´æˆ³å’ŒçŠ¶æ€ï¼‰ |
| `verify-results.json` | `verify-unified` æ­¥éª¤ç”Ÿæˆ | ç»Ÿä¸€æ ˆéªŒè¯è¯¦ç»†ç»“æœï¼ˆå¥åº·æ£€æŸ¥ã€API æµ‹è¯•ï¼‰ |
| `test-results-index.json` | Makefile acceptance target ç”Ÿæˆ | æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶ç´¢å¼• |
| `diagnostics/` | å¤±è´¥æ—¶æ”¶é›† | æœåŠ¡çŠ¶æ€ã€æ—¥å¿—ã€é…ç½®è¯Šæ–­ä¿¡æ¯ |
| `<timestamp>_<name>.json` | `record_acceptance_run.py` ç”Ÿæˆ | æ ‡å‡†åŒ–çš„éªŒæ”¶è¿è¡Œè®°å½•ï¼ˆå« metadataï¼‰ |

**summary.json ç¤ºä¾‹ç»“æ„**ï¼š

```json
{
  "name": "acceptance-unified-min",
  "result": "PASS",
  "failed_step": null,
  "start": "2026-01-30T14:30:22Z",
  "end": "2026-01-30T14:33:45Z",
  "duration_seconds": 203,
  "environment": {
    "HTTP_ONLY_MODE": "1",
    "SKIP_DEGRADATION_TEST": "1",
    "GATE_PROFILE": "http_only"
  }
}
```

**steps.log ç¤ºä¾‹**ï¼š

```
# acceptance-unified-min run started at 2026-01-30T14:30:22Z

ç¯å¢ƒè¯­ä¹‰:
  HTTP_ONLY_MODE=1
  SKIP_DEGRADATION_TEST=1
  GATE_PROFILE=http_only

[OK] deploy - ç»Ÿä¸€æ ˆéƒ¨ç½²å®Œæˆ
[OK] verify-unified - ç»Ÿä¸€æ ˆéªŒè¯é€šè¿‡
[OK] test-logbook-unit - Logbook å•å…ƒæµ‹è¯•é€šè¿‡
[OK] test-gateway-integration - Gateway é›†æˆæµ‹è¯•é€šè¿‡

# Run ended at 2026-01-30T14:33:45Z
# Result: PASS
```

---

### éªŒæ”¶å…¥å£å¯¹ç…§è¡¨

| å‘½ä»¤ | é€‚ç”¨åœºæ™¯ | åŒ…å«ç»„ä»¶ | äº§å‡ºç›®å½• | å…³é”®äº§ç‰© |
|------|----------|----------|----------|----------|
| `acceptance-logbook-only` | Logbook ç‹¬ç«‹éªŒè¯ | PostgreSQL + Logbook | `.artifacts/acceptance-logbook-only/` | summary.json, steps.log, health.json, test-results-index.json, diagnostics/ |
| `acceptance-unified-min` | CI PR å¿«é€ŸéªŒè¯ | ç»Ÿä¸€æ ˆï¼ˆHTTP æ¨¡å¼ï¼‰ | `.artifacts/acceptance-unified-min/` | summary.json, steps.log, verify-results.json, test-results-index.json, diagnostics/ |
| `acceptance-unified-full` | Nightly/å‘å¸ƒå‰ | å®Œæ•´ç»Ÿä¸€æ ˆ | `.artifacts/acceptance-unified-full/` | summary.json, steps.log, verify-results.json, test-results-index.json, diagnostics/ |

### äº§å‡ºç›®å½•ç»“æ„è¯´æ˜

æ¯ä¸ª acceptance ç›®æ ‡ä¼šåœ¨ `.artifacts/acceptance-<target>/` ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
.artifacts/acceptance-<target>/
â”œâ”€â”€ summary.json           # éªŒæ”¶æ‘˜è¦ï¼ˆç»“æœã€æ—¶é—´ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰
â”œâ”€â”€ steps.log              # æ­¥éª¤æ‰§è¡Œæ—¥å¿—
â”œâ”€â”€ verify-results.json    # verify-unified ç»“æœï¼ˆä»… unified-* ç›®æ ‡ï¼‰
â”œâ”€â”€ health.json            # å¥åº·æ£€æŸ¥ç»“æœï¼ˆä»… logbook-only ç›®æ ‡ï¼‰
â”œâ”€â”€ test-results-index.json  # æœ¬æ¬¡è¿è¡Œäº§ç”Ÿçš„ JUnit XML æ–‡ä»¶è·¯å¾„ç´¢å¼•
â””â”€â”€ diagnostics/           # å¤±è´¥æ—¶çš„è¯Šæ–­ä¿¡æ¯ï¼ˆä»…åœ¨å¤±è´¥æ—¶ç”Ÿæˆï¼‰
    â”œâ”€â”€ summary.txt        # è¯Šæ–­æ‘˜è¦
    â”œâ”€â”€ compose-ps.txt     # Docker Compose æœåŠ¡çŠ¶æ€
    â”œâ”€â”€ compose-config.yml # æ¸²æŸ“åçš„ Compose é…ç½®
    â”œâ”€â”€ compose-logs.txt   # å®¹å™¨æ—¥å¿—ï¼ˆæœ€å 500 è¡Œï¼‰
    â”œâ”€â”€ pg-extension.txt   # PostgreSQL æ‰©å±•å’Œ Schema ä¿¡æ¯
    â”œâ”€â”€ health-gateway.json     # Gateway å¥åº·æ£€æŸ¥ç»“æœ
    â””â”€â”€ health-openmemory.json  # OpenMemory å¥åº·æ£€æŸ¥ç»“æœ
```

#### test-results-index.json æ ¼å¼

`test-results-index.json` æä¾›æœ¬æ¬¡éªŒæ”¶è¿è¡Œäº§ç”Ÿçš„æ‰€æœ‰ JUnit XML æµ‹è¯•æŠ¥å‘Šè·¯å¾„ï¼Œä¾¿äº CI è¿½æº¯ï¼š

```json
{
  "generated_at": "2026-01-30T14:30:22+00:00",
  "acceptance_target": "acceptance-unified-min",
  "result": "PASS",
  "test_results": [
    ".artifacts/test-results/logbook-unit.xml",
    ".artifacts/test-results/gateway.xml"
  ]
}
```

#### diagnostics/ ç›®å½•è¯´æ˜

`diagnostics/` å­ç›®å½•ä»…åœ¨éªŒæ”¶æ­¥éª¤å¤±è´¥æ—¶ç”Ÿæˆï¼ŒåŒ…å«ç”¨äºè°ƒè¯•çš„è¯Šæ–­ä¿¡æ¯ã€‚å¯é€šè¿‡ `DIAG_OUTPUT_DIR` ç¯å¢ƒå˜é‡è‡ªå®šä¹‰è¯Šæ–­è¾“å‡ºä½ç½®ã€‚

### åˆ†æ­¥éªŒæ”¶ï¼ˆç»Ÿä¸€æ ˆï¼‰

```bash
make deploy                    # 1. éƒ¨ç½²
make verify-unified            # 2. ç»Ÿä¸€æ ˆéªŒè¯
make logbook-smoke             # 3. Logbook å†’çƒŸæµ‹è¯•
make test-logbook-unit         # 4. Logbook å•å…ƒæµ‹è¯•
make test-gateway-integration  # 5. Gateway é›†æˆæµ‹è¯•
```

### åˆ†æ­¥éªŒæ”¶ï¼ˆLogbook-onlyï¼‰

```bash
make up-logbook                    # 1. å¯åŠ¨ Logbook æœåŠ¡
make migrate-logbook-stepwise      # 2. æ•°æ®åº“è¿ç§»
make verify-permissions-logbook    # 3. æƒé™éªŒè¯
make logbook-smoke                 # 4. å†’çƒŸæµ‹è¯•
make test-logbook-unit             # 5. å•å…ƒæµ‹è¯•
```

---

## è¾“å‡ºçº§åˆ«å®šä¹‰ï¼ˆSKIP/NOTICE/WARN/FAILï¼‰

### è¾“å‡ºçº§åˆ«è¯´æ˜

| çº§åˆ« | å«ä¹‰ | é€€å‡ºç  | ä½¿ç”¨åœºæ™¯ |
|------|------|--------|----------|
| **PASS** | æµ‹è¯•/æ£€æŸ¥é€šè¿‡ | 0 | æ­£å¸¸é€šè¿‡çš„æµ‹è¯•æˆ–éªŒè¯ |
| **SKIP** | æµ‹è¯•è¢«è·³è¿‡ | 0 | åŠŸèƒ½è¢«ç¦ç”¨æˆ–å‰ç½®æ¡ä»¶ä¸æ»¡è¶³ |
| **NOTICE** | æç¤ºä¿¡æ¯ | 0 | éå…³é”®ä¿¡æ¯ï¼Œä¾›å‚è€ƒ |
| **WARN** | è­¦å‘Š | 0 | å¯èƒ½å­˜åœ¨é—®é¢˜ä½†ä¸é˜»å¡ |
| **FAIL** | å¤±è´¥ | 1 | å¿…é¡»ä¿®å¤çš„é—®é¢˜ |

### å¤±è´¥åœºæ™¯

| å¤±è´¥åœºæ™¯ | æœŸæœ›è¾“å‡º | ä¿®å¤æŒ‡å¯¼ |
|----------|----------|----------|
| OM_PG_SCHEMA=public | `[FAIL] OM_PG_SCHEMA=public æ˜¯ç¦æ­¢çš„é…ç½®ï¼` | æ”¹ä¸º `openmemory` æˆ–å…¶ä»–é public schema |
| ç¼ºå°‘æœåŠ¡è´¦å·å¯†ç  | `[FAIL] *_PASSWORD æœªè®¾ç½®` | è®¾ç½®å¯¹åº”çš„ PASSWORD ç¯å¢ƒå˜é‡ |
| æƒé™éªŒè¯å¤±è´¥ | `FAIL: è§’è‰² xxx ä¸å­˜åœ¨` | æ‰§è¡Œ `make bootstrap-roles` ä¿®å¤æƒé™ |

### é™çº§åœºæ™¯

| é™çº§åœºæ™¯ | æœŸæœ›è¾“å‡º | å½±å“èŒƒå›´ |
|----------|----------|----------|
| OpenMemory ä¸å¯ç”¨ | `[WARN] OpenMemory ä¸å¯è¾¾ï¼Œé™çº§åˆ°æœ¬åœ°ç¼“å­˜` | è¯­ä¹‰è®°å¿†æš‚ä¸å¯ç”¨ |
| PostgreSQL è¿æ¥å¤±è´¥ | `[FAIL] æ•°æ®åº“è¿æ¥å¤±è´¥` | æœåŠ¡ä¸å¯ç”¨ |
| MinIO ä¸å¯ç”¨ | `[WARN] å¯¹è±¡å­˜å‚¨ä¸å¯ç”¨ï¼Œåˆ¶å“ä¸Šä¼ é™çº§` | åˆ¶å“å­˜å‚¨åŠŸèƒ½å—é™ |
| åµŒå…¥æœåŠ¡ä¸å¯ç”¨ | `[NOTICE] é™çº§åˆ° synthetic åµŒå…¥` | å‘é‡æ£€ç´¢è´¨é‡ä¸‹é™ |

### Acceptance æµ‹è¯•è¾“å‡ºå¥‘çº¦

éªŒæ”¶æµ‹è¯•åº”éµå¾ªä»¥ä¸‹è¾“å‡ºæ ¼å¼ï¼š

```bash
# æˆåŠŸåœºæ™¯
[OK] ç»„ä»¶åç§° å®Œæˆ
[PASS] æµ‹è¯•åç§°

# è·³è¿‡åœºæ™¯
[SKIP] ç»„ä»¶åç§° å·²è·³è¿‡ (åŸå› )
SKIPPED (åŸå› )

# è­¦å‘Šåœºæ™¯
[WARN] è­¦å‘Šæ¶ˆæ¯

# å¤±è´¥åœºæ™¯
[FAIL] ç»„ä»¶åç§° å¤±è´¥
[ERROR] é”™è¯¯æ¶ˆæ¯
```

---

## è‡ªåŠ¨éªŒæ”¶è®°å½•

æ¯æ¬¡æ‰§è¡Œ `make acceptance-*` å‘½ä»¤ä¼šè‡ªåŠ¨ç”ŸæˆéªŒæ”¶è®°å½•ï¼Œå­˜å‚¨åœ¨ `.artifacts/acceptance-runs/` ç›®å½•ä¸‹ã€‚

### è®°å½•æ–‡ä»¶æ ¼å¼

æ–‡ä»¶åæ ¼å¼ï¼š`<timestamp>_<name>.json`

ç¤ºä¾‹ï¼š`20260130T143022Z_acceptance-logbook-only.json`

### è®°å½•å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `name` | string | éªŒæ”¶å‘½ä»¤åç§°ï¼ˆå¦‚ `acceptance-logbook-only`ï¼‰ |
| `timestamp` | string | ISO 8601 UTC æ—¶é—´æˆ³ |
| `result` | string | `PASS` / `FAIL` / `PARTIAL` |
| `commit` | string | Git commit SHAï¼ˆè‡ªåŠ¨æ£€æµ‹æˆ–æ‰‹åŠ¨æŒ‡å®šï¼‰ |
| `os_version` | string | æ“ä½œç³»ç»ŸåŠç‰ˆæœ¬ï¼ˆå¦‚ `Darwin 24.6.0 (arm64)`ï¼‰ |
| `docker_version` | string | Docker ç‰ˆæœ¬ï¼ˆå¦‚æœ‰ï¼‰ |
| `environment` | object | å…³é”®ç¯å¢ƒå˜é‡ï¼ˆæ•æ„Ÿå€¼å·²è„±æ•ï¼‰ |
| `command` | string | æ‰§è¡Œçš„å‘½ä»¤ï¼ˆé»˜è®¤ `make {name}`ï¼Œå¯é€šè¿‡ `--command` è¦†ç›–ï¼‰ |
| `duration_seconds` | number | æ‰§è¡Œè€—æ—¶ï¼ˆç§’ï¼Œå¦‚å¯ç”¨ï¼‰ |
| `artifacts_dir` | string | äº§ç‰©ç›®å½•è·¯å¾„ |
| `artifacts` | array | äº§ç‰©æ–‡ä»¶è·¯å¾„åˆ—è¡¨ |
| `metadata` | object | **å¯é€‰**ï¼Œè‡ªå®šä¹‰å…ƒæ•°æ®ï¼ˆé€šè¿‡ `--metadata-json` æˆ– `--metadata-kv` ä¼ å…¥ï¼‰ |

#### metadata å­—æ®µè¯´æ˜

`metadata` æ˜¯å¯é€‰çš„æ‰©å±•å­—æ®µï¼Œç”¨äºè®°å½• CI/CD ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¸¸è§çš„ metadata key åŒ…æ‹¬ï¼š

| Key | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-----|------|--------|
| `workflow` | å·¥ä½œæµç±»å‹ | `ci` / `nightly` |
| `profile` | éªŒæ”¶ profile | `http_only` / `full` |
| `github_run_id` | GitHub Actions run ID | `12345678` |
| `github_sha` | GitHub Actions è§¦å‘çš„ commit | `abc123...` |
| `triggered_by` | è§¦å‘æ–¹å¼ | `push` / `schedule` / `workflow_dispatch` |
| `run_number` | GitHub Actions workflow run åºå· | `42` |
| `event_name` | GitHub event ç±»å‹ | `pull_request` / `push` / `schedule` |
| `http_only_mode` | HTTP_ONLY_MODE è®¾ç½®å€¼ | `1` / `0` |
| `skip_degradation` | SKIP_DEGRADATION_TEST è®¾ç½®å€¼ | `1` / `0` |

#### command å­—æ®µè¯´æ˜

`command` å­—æ®µè®°å½•å®é™…æ‰§è¡Œçš„å‘½ä»¤æˆ–æ­¥éª¤åºåˆ—ï¼š

| åœºæ™¯ | command å€¼ç¤ºä¾‹ |
|------|---------------|
| æœ¬åœ° `make acceptance-unified-min` | `make acceptance-unified-min` |
| CI ç»„åˆå¼è¦†ç›– | `deploy â†’ verify-unified(profile=http_only) â†’ openmemory-audit â†’ test-gateway-integration [depends: precheck-static, ...]` |
| Nightly ç›´æ¥æ‰§è¡Œ | `make acceptance-unified-full SKIP_DEPLOY=1` |

CI ç»„åˆå¼è¦†ç›–çš„ command æ ¼å¼è¯´æ˜ï¼š
- `â†’` åˆ†éš”é¡ºåºæ‰§è¡Œçš„æ­¥éª¤
- `[depends: ...]` åˆ—å‡ºå‰ç½®ä¾èµ–çš„ jobï¼ˆé acceptance æ­¥éª¤æœ¬èº«ï¼‰
- æ‹¬å·å†…å‚æ•°å¦‚ `profile=http_only` è¡¨ç¤ºç¯å¢ƒå˜é‡è®¾ç½®

### ç¤ºä¾‹è®°å½•

**åŸºç¡€ç¤ºä¾‹**ï¼ˆæ—  metadataï¼‰ï¼š

```json
{
  "name": "acceptance-logbook-only",
  "timestamp": "2026-01-30T14:30:22+00:00",
  "result": "PASS",
  "commit": "abc1234def5678...",
  "os_version": "Darwin 24.6.0 (arm64)",
  "docker_version": "Docker version 24.0.6, build ed223bc",
  "environment": {
    "SKIP_DEPLOY": "0",
    "POSTGRES_DSN": "postgresql://user:***@localhost:5432/engram"
  },
  "command": "make acceptance-logbook-only",
  "duration_seconds": 45,
  "artifacts_dir": ".artifacts/acceptance-logbook-only",
  "artifacts": [
    ".artifacts/acceptance-logbook-only/summary.json",
    ".artifacts/acceptance-logbook-only/steps.log",
    ".artifacts/acceptance-logbook-only/health.json"
  ]
}
```

**CI ç¤ºä¾‹**ï¼ˆå« metadataï¼‰ï¼š

```json
{
  "name": "acceptance-unified-min",
  "timestamp": "2026-01-30T15:00:00+00:00",
  "result": "PASS",
  "commit": "def5678abc1234...",
  "os_version": "Linux 5.15.0 (x86_64)",
  "docker_version": "Docker version 24.0.6, build ed223bc",
  "environment": {
    "HTTP_ONLY_MODE": "1",
    "GATE_PROFILE": "http_only"
  },
  "command": "make acceptance-unified-min HTTP_ONLY_MODE=1",
  "duration_seconds": 180,
  "artifacts_dir": ".artifacts/acceptance-unified-min",
  "artifacts": [
    ".artifacts/acceptance-unified-min/summary.json",
    ".artifacts/acceptance-unified-min/steps.log"
  ],
  "metadata": {
    "workflow": "ci",
    "profile": "http_only",
    "github_run_id": "12345678",
    "triggered_by": "push"
  }
}
```

### æ‰‹åŠ¨ç”Ÿæˆè®°å½•

å¦‚éœ€æ‰‹åŠ¨è®°å½•éªŒæ”¶è¿è¡Œï¼ˆä¾‹å¦‚åˆ†æ­¥æ‰§è¡Œåï¼‰ï¼Œå¯ä½¿ç”¨ï¼š

```bash
python3 scripts/acceptance/record_acceptance_run.py \
    --name acceptance-logbook-only \
    --artifacts-dir .artifacts/acceptance-logbook-only \
    --result PASS \
    [--commit <sha>] \
    [--command <custom command>] \
    [--metadata-json '{"workflow": "ci", "profile": "http_only"}'] \
    [--metadata-kv workflow=ci --metadata-kv profile=http_only]
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| `--name` | âœ… | éªŒæ”¶å‘½ä»¤åç§° |
| `--artifacts-dir` | âœ… | äº§ç‰©ç›®å½•è·¯å¾„ |
| `--result` | âœ… | ç»“æœï¼ˆ`PASS` / `FAIL` / `PARTIAL`ï¼‰ |
| `--commit` | âŒ | Git commit SHAï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰ |
| `--command` | âŒ | è‡ªå®šä¹‰å‘½ä»¤ï¼ˆé»˜è®¤ `make {name}`ï¼‰ |
| `--metadata-json` | âŒ | JSON æ ¼å¼çš„å…ƒæ•°æ® |
| `--metadata-kv` | âŒ | key=value æ ¼å¼çš„å…ƒæ•°æ®ï¼ˆå¯å¤šæ¬¡ä½¿ç”¨ï¼‰ |

#### CI é›†æˆç¤ºä¾‹

```bash
# GitHub Actions CI ç¤ºä¾‹
python3 scripts/acceptance/record_acceptance_run.py \
    --name acceptance-unified-min \
    --artifacts-dir .artifacts/acceptance-unified-min \
    --result PASS \
    --command "make acceptance-unified-min HTTP_ONLY_MODE=1" \
    --metadata-json '{"workflow": "ci", "profile": "http_only"}' \
    --metadata-kv "github_run_id=${GITHUB_RUN_ID}" \
    --metadata-kv "triggered_by=${GITHUB_EVENT_NAME}"

# Nightly éªŒæ”¶ç¤ºä¾‹
python3 scripts/acceptance/record_acceptance_run.py \
    --name acceptance-unified-full \
    --artifacts-dir .artifacts/acceptance-unified-full \
    --result PASS \
    --command "make acceptance-unified-full VERIFY_FULL=1" \
    --metadata-kv workflow=nightly \
    --metadata-kv profile=full
```

**æ³¨æ„**ï¼š`--metadata-kv` çš„å€¼ä¼šè¦†ç›– `--metadata-json` ä¸­çš„åŒå keyã€‚

### æŸ¥è¯¢å†å²è®°å½•

```bash
# åˆ—å‡ºæ‰€æœ‰éªŒæ”¶è®°å½•
ls -la .artifacts/acceptance-runs/

# æŸ¥çœ‹æœ€æ–°è®°å½•
cat .artifacts/acceptance-runs/$(ls -t .artifacts/acceptance-runs/ | head -1)

# æŒ‰åç§°ç­›é€‰
ls .artifacts/acceptance-runs/*acceptance-logbook-only*
```

### è‡ªåŠ¨æ±‡æ€»äº§ç‰©

CI/Nightly å·¥ä½œæµä¼šè‡ªåŠ¨ç”ŸæˆéªŒæ”¶çŸ©é˜µæ±‡æ€»äº§ç‰©ï¼Œèšåˆ `.artifacts/acceptance-runs/*.json` ä¸­çš„è®°å½•ã€‚

#### äº§ç‰©æ–‡ä»¶

| æ–‡ä»¶ | æ ¼å¼ | è¯´æ˜ |
|------|------|------|
| `.artifacts/acceptance-matrix.md` | Markdown | äººç±»å¯è¯»çš„éªŒæ”¶è¶‹åŠ¿è¡¨æ ¼ |
| `.artifacts/acceptance-matrix.json` | JSON | ç»“æ„åŒ–æ•°æ®ï¼Œå¯ç”¨äºè¿›ä¸€æ­¥åˆ†æ |

#### ç”Ÿæˆæ–¹å¼

**æ‰‹åŠ¨ç”Ÿæˆ**:

```bash
# ä½¿ç”¨ Makefile ç›®æ ‡
make acceptance-matrix

# è‡ªå®šä¹‰å‚æ•°
make acceptance-matrix MATRIX_LIMIT=10 MATRIX_OUTPUT_DIR=.artifacts

# ç›´æ¥è°ƒç”¨è„šæœ¬
python3 scripts/acceptance/render_acceptance_matrix.py \
    --limit 5 \
    --output-dir .artifacts \
    --runs-dir .artifacts/acceptance-runs
```

**CI/Nightly è‡ªåŠ¨ç”Ÿæˆ**:

- `ci.yml`: åœ¨ `unified-standard` job å®Œæˆåè‡ªåŠ¨ç”Ÿæˆï¼ˆ`if: always()`ï¼‰
- `nightly.yml`: åœ¨ `acceptance-unified-full` å®Œæˆåè‡ªåŠ¨ç”Ÿæˆï¼ˆ`if: always()`ï¼‰

#### äº§ç‰©å†…å®¹ç¤ºä¾‹

**Markdown æ±‡æ€» (`acceptance-matrix.md`)**:

| Name | Profile | Workflow | Pass Rate | Latest | Commit | Avg Duration |
|------|---------|----------|-----------|--------|--------|--------------|
| acceptance-unified-min | http_only | ci | âœ… 100% | âœ… PASS | `abc1234` | 180s |
| acceptance-unified-full | full | nightly | ğŸŸ¡ 80% | âœ… PASS | `def5678` | 420s |

**JSON ç»“æ„ (`acceptance-matrix.json`)**:

```json
{
  "generated_at": "2026-01-30T12:00:00Z",
  "limit_per_group": 5,
  "groups": [
    {
      "name": "acceptance-unified-min",
      "profile": "http_only",
      "workflow": "ci",
      "stats": {
        "count": 5,
        "pass_count": 5,
        "fail_count": 0,
        "pass_rate": 1.0,
        "avg_duration_seconds": 180.0,
        "latest_result": "PASS"
      },
      "records": [...]
    }
  ],
  "summary": {
    "total_groups": 3,
    "total_records": 15,
    "overall_pass_rate": 0.93
  }
}
```

#### CI Artifact ä¸‹è½½

éªŒæ”¶çŸ©é˜µä½œä¸º CI artifact ä¸Šä¼ ï¼Œå¯ä» GitHub Actions é¡µé¢ä¸‹è½½ï¼š

- **CI**: `acceptance-matrix-{profile}-{run_number}`
- **Nightly**: `nightly-acceptance-matrix-{run_number}`

#### è„šæœ¬å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--limit N` | æ¯ç»„æ˜¾ç¤ºæœ€è¿‘ N æ¡è®°å½• | 5 |
| `--output-dir` | è¾“å‡ºç›®å½• | `.artifacts` |
| `--runs-dir` | acceptance-runs ç›®å½• | `.artifacts/acceptance-runs` |
| `--json-only` | ä»…è¾“å‡º JSON | false |
| `--md-only` | ä»…è¾“å‡º Markdown | false |

### åœ¨éªŒæ”¶çŸ©é˜µä¸­å¼•ç”¨è®°å½•

åœ¨å¡«å†™è¿­ä»£éªŒæ”¶è®°å½•æ—¶ï¼Œå¯å¼•ç”¨è‡ªåŠ¨ç”Ÿæˆçš„è®°å½•æ–‡ä»¶ï¼š

```markdown
**éªŒæ”¶è®°å½•**: `.artifacts/acceptance-runs/<timestamp>_<name>.json`ï¼ˆæœ¬åœ°æ‰§è¡Œè®°å½•ï¼Œcommit `<sha>`ï¼‰
```

---

## è¯æ®å¼•ç”¨è§„èŒƒ

æœ¬èŠ‚å®šä¹‰åœ¨è¿­ä»£æ–‡æ¡£å’ŒéªŒæ”¶è®°å½•ä¸­å¼•ç”¨è¯æ®çš„è§„èŒƒæ ¼å¼ã€‚

> **å®Œæ•´ç­–ç•¥**ï¼šå‚è§ [ADR: è¿­ä»£æ–‡æ¡£å·¥ä½œæµ](../architecture/adr_iteration_docs_workflow.md#35-ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶)

### å¼•ç”¨æ ¼å¼å¯¹ç…§è¡¨

| è¯æ®æ¥æº | å¼•ç”¨æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|----------|----------|------|------|
| **ç‰ˆæœ¬åŒ–æ–‡æ¡£** | ç›¸å¯¹è·¯å¾„ Markdown é“¾æ¥ | `[è®¡åˆ’](iteration_13_plan.md)` | âœ… æ¨è |
| **ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶** | ç›¸å¯¹è·¯å¾„ Markdown é“¾æ¥ | `[è¯æ®](evidence/iteration_13_evidence.json)` | âœ… æ¨èï¼Œç”¨äºç»“æ„åŒ–è¯æ® |
| **CI Run URL** | å®Œæ•´ URL | `[CI #1234](https://github.com/.../runs/1234)` | âœ… æœ€æ¨èï¼Œæ°¸ä¹…æœ‰æ•ˆ |
| **CI Artifact** | URL + è¯´æ˜ | `æŠ¥å‘Šè§ CI Artifacts (90 å¤©æœ‰æ•ˆ)` | âš ï¸ æœ‰æ—¶æ•ˆæ€§ |
| **æœ¬åœ°è‰ç¨¿ (`.iteration/`)** | **ç¦æ­¢é“¾æ¥**ï¼Œä»…æ–‡æœ¬æåŠ | `å‚è€ƒ .iteration/ ä¸­çš„è‰ç¨¿` | âŒ Markdown é“¾æ¥ç¦æ­¢ |
| **è¿è¡Œæ—¶äº§ç‰© (`.artifacts/`)** | **ç¦æ­¢é“¾æ¥**ï¼Œä»…æ–‡æœ¬æåŠ | `æœ¬åœ°äº§ç‰©ä½äº .artifacts/` | âŒ Markdown é“¾æ¥ç¦æ­¢ |

### `.artifacts/` å’Œ `.iteration/` å¼•ç”¨çº¦æŸ

**æ ¸å¿ƒè§„åˆ™**ï¼š`.artifacts/` ä¸ `.iteration/` ä¸€æ ·ï¼Œ**ä¸å¾—åœ¨ç‰ˆæœ¬åŒ–æ–‡æ¡£ä¸­ä»¥ Markdown é“¾æ¥å½¢å¼å‡ºç°**ã€‚

| ç±»å‹ | `.artifacts/` ç¤ºä¾‹ | `.iteration/` ç¤ºä¾‹ | å…è®¸ |
|------|-------------------|-------------------|------|
| **Markdown é“¾æ¥** | `[æŠ¥å‘Š]` + `(.artifacts/...)` | `[è‰ç¨¿]` + `(.iteration/...)` | âŒ **ç¦æ­¢** |
| **æ–‡æœ¬æåŠ** | `æœ¬åœ°äº§ç‰©ä½äº .artifacts/` | `å‚è€ƒ .iteration/ ä¸­çš„è‰ç¨¿` | âœ… å…è®¸ |
| **inline code** | `` `.artifacts/test-results.xml` `` | `` `.iteration/13/plan.md` `` | âœ… å…è®¸ |

**ç†ç”±**ï¼š

1. `.artifacts/` å’Œ `.iteration/` å‡åœ¨ `.gitignore` ä¸­ï¼Œä¸çº³å…¥ç‰ˆæœ¬æ§åˆ¶
2. é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶åœ¨å…¶ä»–æœºå™¨æˆ– CI ç¯å¢ƒä¸­ä¸å­˜åœ¨ï¼Œå¿…ç„¶å¤±æ•ˆ
3. CI Artifacts æœ‰ä¿ç•™æœŸé™ï¼ˆé€šå¸¸ 30-90 å¤©ï¼‰ï¼Œé“¾æ¥ä¼šè¿‡æœŸ

### ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶

å½“éœ€è¦æŒä¹…åŒ–ç»“æ„åŒ–è¯æ®æ—¶ï¼Œåº”å°†è¯æ®æ–‡ä»¶å­˜å‚¨åœ¨ `docs/acceptance/evidence/` ç›®å½•ã€‚

> **å®Œæ•´ç­–ç•¥**ï¼šå‚è§ [ADR: è¿­ä»£æ–‡æ¡£å·¥ä½œæµ - 3.5 ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶](../architecture/adr_iteration_docs_workflow.md#35-ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶)

**å‘½åè§„èŒƒï¼ˆç»Ÿä¸€ï¼‰**ï¼š

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|------|
| **Canonicalï¼ˆè§„èŒƒï¼‰** | `iteration_<N>_evidence.json` | `iteration_13_evidence.json` | âœ… æ¨èï¼Œå•ä¸€è¿­ä»£ç»¼åˆè¯æ®ï¼Œæ¯æ¬¡æ›´æ–°è¦†ç›– |
| **Snapshotï¼ˆå¿«ç…§ï¼‰** | `iteration_<N>_<YYYYMMDD_HHMMSS>.json` | `iteration_13_20260202_143000.json` | å†å²å¿«ç…§ï¼Œéœ€ä¿ç•™å¤šæ¬¡éªŒæ”¶è®°å½•æ—¶æ‰‹åŠ¨åˆ›å»º |
| **Snapshot+SHA** | `iteration_<N>_<YYYYMMDD_HHMMSS>_<sha7>.json` | `iteration_13_20260202_143000_abc1234.json` | å¸¦ commit SHA çš„å†å²å¿«ç…§ |

**ç”Ÿæˆå‘½ä»¤**ï¼š

```bash
# ç”Ÿæˆ canonical è¯æ®æ–‡ä»¶ï¼ˆæ¨èï¼‰
python scripts/iteration/record_iteration_evidence.py <N>

# æŒ‡å®š CI è¿è¡Œ URL
python scripts/iteration/record_iteration_evidence.py <N> \
  --ci-run-url https://github.com/<org>/<repo>/actions/runs/<run_id>

# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…å†™å…¥ï¼‰
python scripts/iteration/record_iteration_evidence.py <N> --dry-run
```

**å›å½’æ–‡æ¡£å¼•ç”¨ç¤ºä¾‹**ï¼š

```markdown
## éªŒæ”¶è¯æ®

è¯¦ç»†è¯æ®è§ [iteration_13_evidence.json](evidence/iteration_13_evidence.json)ã€‚

å…³é”®æŒ‡æ ‡æ‘˜è¦ï¼š
- CI é—¨ç¦ï¼šâœ… å…¨éƒ¨é€šè¿‡
- æµ‹è¯•è¦†ç›–ï¼š608 passed, 0 failed
- CI Run: [GitHub Actions #1234](https://github.com/.../actions/runs/1234)
```

**æ³¨æ„**ï¼šâŒ ç¦æ­¢æ‰‹åŠ¨åˆ›å»ºåŒ…å«å ä½ç¬¦çš„è‰ç¨¿è¯æ®æ–‡ä»¶å¹¶æäº¤ï¼Œåº”ä½¿ç”¨è„šæœ¬ç”Ÿæˆã€‚

### æ¨èå¼•ç”¨æ–¹å¼ä¼˜å…ˆçº§

1. **CI Run URL**ï¼ˆæœ€æ¨èï¼‰ï¼šæ°¸ä¹…æœ‰æ•ˆã€å¯è¿½æº¯ã€åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡
2. **ç‰ˆæœ¬åŒ–è¯æ®æ–‡ä»¶é“¾æ¥**ï¼šé€‚ç”¨äºéœ€è¦ç»“æ„åŒ–æ•°æ®çš„åœºæ™¯
3. **æ–‡æ¡£å†…åµŒæ‘˜è¦**ï¼šå…³é”®ä¿¡æ¯åœ¨æ–‡æ¡£ä¸­ç›´æ¥å¯è§ï¼Œæ— éœ€è·³è½¬

---

## å†å²éªŒæ”¶è®°å½•ç´¢å¼•

| æ—¥æœŸ | Commit | ç»“æœ | è®°å½•æ–‡ä»¶ | å¤‡æ³¨ |
|------|--------|------|----------|------|
| 2026-02-01 | - | **PARTIAL** | [iteration_10_regression.md](iteration_10_regression.md) | **Iteration 10 å›å½’éªŒè¯**ï¼šlint âœ…ï¼Œmypy âŒ (86 æ–°å¢é”™è¯¯)ï¼Œgateway æµ‹è¯• âš ï¸ (15 å¤±è´¥/807 é€šè¿‡)ï¼Œacceptance âœ… (158 é€šè¿‡) |
| 2026-02-01 | - | **PARTIAL** | [iteration_9_regression.md](iteration_9_regression.md) | **Iteration 9 å›å½’éªŒè¯**ï¼šlint âœ…ï¼Œmypy âŒ (77 æ–°å¢é”™è¯¯)ï¼Œgateway æµ‹è¯• âš ï¸ (4 å¤±è´¥/813 é€šè¿‡)ï¼Œacceptance âœ… (143 é€šè¿‡) |
| 2026-01-30 | `4d5d607` | **PASS** | `.artifacts/acceptance-runs/20260130T000804Z_acceptance-logbook-only.json`ï¼ˆæœ¬åœ°ï¼‰ | acceptance-logbook-only é€šè¿‡ï¼›æ‰§è¡Œæ­¥éª¤ï¼š`up-logbook` â†’ `migrate-logbook-stepwise` â†’ `verify-permissions-logbook` â†’ `logbook-smoke` â†’ `test-logbook-unit` |
| 2026-01-30 | `4d5d607` | **PASS** | `.artifacts/acceptance-runs/20260130T000805Z_acceptance-unified-min.json`ï¼ˆæœ¬åœ°ï¼‰ | acceptance-unified-min é€šè¿‡ï¼›æ‰§è¡Œæ­¥éª¤ï¼š`deploy` â†’ `verify-unified (HTTP_ONLY_MODE)` â†’ `test-logbook-unit` â†’ `test-gateway-integration (HTTP_ONLY_MODE)` |
| 2026-01-30 | - | PASS | `.artifacts/naming-audit/iteration10_step_tokens.txt`, `.artifacts/naming-audit/iteration10_legacy_alias_scan.json`ï¼ˆæœ¬åœ°å®¡è®¡è®°å½•ï¼‰ | **è¿­ä»£ 10 å‘½åæ²»ç†å®¡è®¡**ï¼šstep token æ‰«æ 95 å¤„ï¼ˆå‡ä¸ºåˆè§„çš„ `Step N` æµç¨‹ç¼–å·æ ¼å¼ï¼‰ï¼›legacy alias æ£€æµ‹ 0 å¤„è¿è§„ï¼ˆ570 æ–‡ä»¶æ‰«æé€šè¿‡ï¼‰ |

### æœªè¦†ç›–èŒƒå›´ï¼ˆ2026-01-30ï¼‰

| æµ‹è¯•å‘½ä»¤ | çŠ¶æ€ | åŸå›  | é£é™©ç­‰çº§ |
|----------|------|------|----------|
| `acceptance-unified-full` | æœªæ‰§è¡Œ | å½“å‰è¿­ä»£ä¾§é‡æ–‡æ¡£æ•´ç†ï¼Œfull éªŒæ”¶å¾… Nightly è¡¥å…… | **ä¸­** |

**é£é™©è¯„ä¼°**:

- **ä¸­é£é™©**: `acceptance-unified-full` æœªæ‰§è¡Œï¼Œé™çº§æµ‹è¯•ï¼ˆdegradationï¼‰å’Œå®Œæ•´é›†æˆæµ‹è¯•ï¼ˆ`test-gateway-integration-full`ï¼‰æœªéªŒè¯ã€‚å»ºè®®åœ¨ä¸‹æ¬¡ Nightly æˆ–å‘å¸ƒå‰è¡¥å……æ‰§è¡Œã€‚
- **ä½é£é™©**: `acceptance-logbook-only` å’Œ `acceptance-unified-min` å·²é€šè¿‡ï¼Œæ ¸å¿ƒåŠŸèƒ½å’Œ CI PR åœºæ™¯å·²è¦†ç›–ã€‚

---

## é—¨ç¦ Profile ä¸éªŒè¯æ­¥éª¤æ˜ å°„

> **å•ä¸€æ¥æº**: `scripts/unified_stack_gate_contract.py`

éªŒè¯æµç¨‹çš„é—¨ç¦è§„åˆ™ç”± `unified_stack_gate_contract.py` å®šä¹‰ï¼Œæœ¬èŠ‚æ–‡æ¡£ä¸å…¶ä¿æŒåŒæ­¥ã€‚

### Profile å®šä¹‰

| Profile | ç¯å¢ƒå˜é‡æ¡ä»¶ | æè¿° |
|---------|--------------|------|
| **http_only** | `HTTP_ONLY_MODE=1` æˆ– `GATE_PROFILE=http_only` | ä»… HTTP æ¥å£éªŒè¯ï¼ˆæ—  MCP JSON-RPCï¼‰ |
| **standard** | é»˜è®¤ï¼Œæˆ– `SKIP_DEGRADATION_TEST=1` | æ ‡å‡†æ¨¡å¼ï¼ˆHTTP + JSON-RPCï¼Œæ— é™çº§æµ‹è¯•ï¼‰ |
| **full** | `GATE_PROFILE=full` æˆ–æ˜¾å¼è°ƒç”¨ `--full` | å®Œæ•´æ¨¡å¼ï¼ˆæ‰€æœ‰æ­¥éª¤ï¼ŒåŒ…æ‹¬é™çº§æµ‹è¯•å’Œ DB ä¸å˜é‡æ£€æŸ¥ï¼‰ |

### å„ Profile çš„ required_steps ä¸ must_fail_if_blocked æ˜ å°„

å¼•ç”¨è‡ª `scripts/unified_stack_gate_contract.py::PROFILE_CONFIGS`:

#### http_only Profile

```python
# required_steps:
- health_checks
- memory_store
- memory_query

# optional_steps:
- db_invariants

# required_capabilities:
- openmemory_endpoint_present

# must_fail_if_blocked: []  # æ— å¼ºåˆ¶å¤±è´¥é¡¹
```

**è¡Œä¸º**: ç¼ºå°‘èƒ½åŠ›æ—¶å¯è·³è¿‡ï¼ˆskipï¼‰ï¼Œä¸ä¼šå¼ºåˆ¶å¤±è´¥ã€‚

#### standard Profile

```python
# required_steps:
- health_checks
- memory_store
- memory_query
- jsonrpc

# optional_steps:
- db_invariants

# required_capabilities:
- openmemory_endpoint_present

# must_fail_if_blocked: []  # æ— å¼ºåˆ¶å¤±è´¥é¡¹
```

**è¡Œä¸º**: ä¸ http_only ç±»ä¼¼ï¼Œå¢åŠ äº† JSON-RPC åè®®éªŒè¯ã€‚ç¼ºå°‘èƒ½åŠ›æ—¶å¯è·³è¿‡ã€‚

#### full Profile

```python
# required_steps:
- health_checks
- db_invariants
- memory_store
- memory_query
- jsonrpc
- degradation

# optional_steps: []  # æ— å¯é€‰æ­¥éª¤

# required_capabilities:
- openmemory_endpoint_present
- docker_available
- docker_daemon_ok
- can_stop_openmemory
- db_access_available  # psql æˆ– psycopg ä¹‹ä¸€
- postgres_dsn_present

# must_fail_if_blocked:
- degradation      # ç¼ºå°‘ can_stop_openmemory å¿…é¡» FAIL
- db_invariants    # ç¼ºå°‘ postgres_dsn æˆ– db_access å¿…é¡» FAIL
```

**è¡Œä¸º**: å…³é”®æ­¥éª¤ç¼ºå°‘èƒ½åŠ›æ—¶**å¿…é¡» FAIL**ï¼Œä¸èƒ½é™é»˜è·³è¿‡ã€‚è¿™æ˜¯ç”Ÿäº§å‘å¸ƒå‰çš„ç¡¬æ€§é—¨ç¦ã€‚

### Capability æ£€æµ‹

| Capability | æ£€æµ‹æ–¹å¼ | å½±å“çš„æ­¥éª¤ |
|------------|----------|------------|
| `docker_available` | `shutil.which("docker")` | degradation |
| `docker_daemon_ok` | `docker info` è¿”å› 0 | degradation |
| `can_stop_openmemory` | Docker + compose å¯ç”¨ä¸”æœ‰é…ç½® | degradation |
| `psql_available` | `shutil.which("psql")` | db_invariants |
| `psycopg_available` | `import psycopg2` æˆ– `import psycopg` | db_invariants |
| `db_access_available` | psql æˆ– psycopg ä¹‹ä¸€å¯ç”¨ | db_invariants |
| `postgres_dsn_present` | `POSTGRES_DSN` ç¯å¢ƒå˜é‡å·²è®¾ç½® | db_invariants |
| `openmemory_endpoint_present` | `OPENMEMORY_ENDPOINT` ç¯å¢ƒå˜é‡å·²è®¾ç½® | æ‰€æœ‰æ­¥éª¤ |

### éªŒè¯ Profile å‘½ä»¤

```bash
# æ£€æµ‹å½“å‰ç¯å¢ƒèƒ½åŠ›
python scripts/unified_stack_gate_contract.py detect-capabilities

# æ ¡éªŒæŒ‡å®š profile æ˜¯å¦å¯æ‰§è¡Œ
python scripts/unified_stack_gate_contract.py validate-profile full

# è·å–æŒ‡å®š profile çš„å¿…éœ€æ­¥éª¤
python scripts/unified_stack_gate_contract.py get-required-steps full

# ä»ç¯å¢ƒå˜é‡æ¨æ–­å½“å‰ profile
python scripts/unified_stack_gate_contract.py get-profile

# å¯¼å‡ºå®Œæ•´è§„åˆ™è¡¨ï¼ˆJSON æ ¼å¼ï¼Œä¾› Bash/å…¶ä»–å·¥å…·è§£æï¼‰
python scripts/unified_stack_gate_contract.py dump-rules
```

### Profile ä¸ Makefile ç›®æ ‡å¯¹ç…§

| Makefile ç›®æ ‡ | å¯¹åº” Profile | è¯´æ˜ |
|---------------|--------------|------|
| `make test-gateway-integration` | http_only/standard | `HTTP_ONLY_MODE=1` æ—¶ä¸º http_only |
| `make test-gateway-integration-full` | full | éœ€è¦ Docker æƒé™å’Œ POSTGRES_DSN |
| `make verify-unified` | standard | åŸºç¡€éªŒè¯ï¼ˆè‡ªåŠ¨åˆ¤æ–­æ¨¡å¼ï¼‰ |
| `VERIFY_FULL=1 make verify-unified` | full | å®Œæ•´éªŒè¯ï¼ˆå«é™çº§æµ‹è¯•ï¼‰ |
| `make acceptance-unified-min` | standard | CI PR å¿«é€ŸéªŒè¯ |
| `make acceptance-unified-full` | full | Nightly/å‘å¸ƒå‰å®Œæ•´éªŒæ”¶ |

### æµ‹è¯•è¡Œä¸ºçŸ©é˜µ

| æµ‹è¯•ç±»/åœºæ™¯ | http_only | standard | fullï¼ˆç¼ºèƒ½åŠ›æ—¶ï¼‰ |
|-------------|-----------|----------|------------------|
| `TestServiceHealthCheck` | è¿è¡Œ | è¿è¡Œ | è¿è¡Œ |
| `TestMemoryOperations` | è¿è¡Œ | è¿è¡Œ | è¿è¡Œ |
| `TestJsonRpcProtocol` | è·³è¿‡ | è¿è¡Œ | è¿è¡Œ |
| `TestDegradationFlow` | è·³è¿‡ | è·³è¿‡ | **FAIL** |
| `TestOutboxWorkerRealIntegration` | è·³è¿‡ | è·³è¿‡ | **FAIL** |
| `TestDatabaseRolesVerification` | è·³è¿‡ï¼ˆæ—  DSNï¼‰ | è·³è¿‡ï¼ˆæ—  DSNï¼‰ | **FAIL** |

### Outbox Worker çœŸå®é›†æˆæµ‹è¯•ï¼ˆFULL å¿…æµ‹ï¼‰

**é‡è¦**ï¼šä»¥ä¸‹ Outbox Worker é›†æˆæµ‹è¯•åœ¨ `acceptance-unified-full` ä¸­ä¸º**å¿…æµ‹é¡¹**ï¼š

| æµ‹è¯•ç±» | æµ‹è¯•æ–¹æ³• | éªŒè¯ç‚¹ | HTTP_ONLY è¡Œä¸º |
|--------|----------|--------|----------------|
| `TestOutboxWorkerIntegrationSuccess` | `test_success_path_status_transition` | outbox çŠ¶æ€ `pendingâ†’sent`ï¼Œå®¡è®¡ `outbox_flush_success` | SKIP |
| `TestOutboxWorkerIntegrationRetry` | `test_retry_path_status_and_retry_count` | outbox çŠ¶æ€ä¿æŒ `pending`ï¼Œå®¡è®¡ `outbox_flush_retry` | SKIP |
| `TestOutboxWorkerIntegrationRetry` | `test_retry_path_becomes_dead_after_max_retries` | outbox çŠ¶æ€ `pendingâ†’dead`ï¼Œå®¡è®¡ `outbox_flush_dead` | SKIP |
| `TestOutboxDegradationRecoveryE2E` | `test_degradation_to_outbox_recovery_flush_audit_consistency` | å®Œæ•´é™çº§â†’æ¢å¤æµç¨‹ï¼Œå« Docker stop/start | SKIP |

**å¿…éœ€èƒ½åŠ›**ï¼š
- `docker_available`: Docker å¯æ‰§è¡Œæ–‡ä»¶å­˜åœ¨
- `docker_daemon_ok`: Docker daemon è¿è¡Œä¸­
- `can_stop_openmemory`: å¯ä»¥ stop/start OpenMemory å®¹å™¨
- `postgres_dsn_present`: `POSTGRES_DSN` ç¯å¢ƒå˜é‡å·²è®¾ç½®

**å®¡è®¡éªŒè¯ç‚¹**ï¼ˆFULL å¿…æµ‹ï¼‰ï¼š
1. **çŠ¶æ€æµè½¬æ–­è¨€**ï¼šoutbox è®°å½•åœ¨ `pending`/`sent`/`dead` ä¸‰ç§çŠ¶æ€ä¹‹é—´æ­£ç¡®æµè½¬
2. **å®¡è®¡ reason æ–­è¨€**ï¼š`governance.write_audit` è®°å½•çš„ `reason` å­—æ®µæ­£ç¡®ä¸ºï¼š
   - `outbox_flush_success`ï¼šæˆåŠŸå†™å…¥ OpenMemory
   - `outbox_flush_retry`ï¼šå¯é‡è¯•å¤±è´¥ï¼Œå·²å®‰æ’é‡è¯•
   - `outbox_flush_dead`ï¼šä¸å¯æ¢å¤å¤±è´¥ï¼Œæ ‡è®°ä¸ºæ­»ä¿¡
3. **evidence_refs_json å¯æŸ¥è¯¢**ï¼šå®¡è®¡è®°å½•ä¸­ `(evidence_refs_json->>'outbox_id')::int` å¯æ­£ç¡®å…³è”å› outbox è®°å½•

**è·³è¿‡è¾“å‡ºå¥‘çº¦**ï¼š
å½“ `HTTP_ONLY_MODE=1` æ—¶ï¼Œä¸Šè¿°æµ‹è¯•åº”è¾“å‡ºæ˜ç¡®çš„ SKIP ä¿¡æ¯ï¼š
```
SKIPPED (HTTP_ONLY_MODE: Outbox Worker é›†æˆæµ‹è¯•éœ€è¦ Docker å’Œæ•°æ®åº“)
```

---

## Import è¿ç§»éªŒæ”¶æ£€æŸ¥

æœ¬èŠ‚è¯´æ˜æ ¹ç›®å½• Wrapper æ¨¡å—è¿ç§»çš„éªŒæ”¶æ£€æŸ¥é¡¹ã€‚

### è¿ç§»éªŒæ”¶ Checklist

| # | æ£€æŸ¥é¡¹ | éªŒè¯å‘½ä»¤ | é€šè¿‡æ ‡å‡† |
|---|--------|----------|----------|
| 1 | æ— æ–°å¢å¼ƒç”¨æ¨¡å—å¯¼å…¥ | `make check-no-root-wrappers` | é€€å‡ºç  0 |
| 2 | Allowlist æ¡ç›®æœªè¿‡æœŸ | `python scripts/ci/check_no_root_wrappers_allowlist.py` | æ— è¿‡æœŸè­¦å‘Š |
| 3 | CLI å…¥å£ä¸€è‡´æ€§ | `make check-cli-entrypoints` | pyproject.toml ä¸æ–‡æ¡£ä¸€è‡´ |
| 4 | å¼ƒç”¨è­¦å‘Šæ­£ç¡®è¾“å‡º | æ‰‹åŠ¨éªŒè¯ï¼ˆè§ä¸‹æ–¹ï¼‰ | è­¦å‘Šæ ¼å¼æ­£ç¡® |
| 5 | æµ‹è¯•è¦†ç›–è¿ç§»åè·¯å¾„ | `pytest tests/ -v -k "cli or import"` | æ— æµ‹è¯•å¤±è´¥ |

### å¼ƒç”¨è­¦å‘ŠéªŒè¯

è¿ç§»åï¼Œå¼ƒç”¨å…¥å£åº”è¾“å‡ºç»Ÿä¸€æ ¼å¼çš„è­¦å‘Šï¼š

```bash
# éªŒè¯æ ¹ç›®å½•å…¥å£
python artifact_cli.py --help 2>&1 | head -15

# æœŸæœ›è¾“å‡ºåŒ…å«ï¼š
# âš ï¸  DEPRECATION WARNING
# [DEPRECATED] 'artifact_cli.py' å·²å¼ƒç”¨ï¼Œè®¡åˆ’åœ¨ v2.0 ç‰ˆæœ¬ç§»é™¤ã€‚
# è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ›¿ä»£:
#     - engram-artifacts [args]
```

### è¿ç§»ç›¸å…³æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•æ–‡ä»¶ | éªŒè¯å†…å®¹ | éœ€è¦ä¾‹å¤–å£°æ˜ |
|----------|----------|--------------|
| `tests/logbook/test_artifacts_cli.py` | `engram-artifacts` CLI åŠŸèƒ½ | å¦ |
| `tests/logbook/test_artifact_gc.py` | Artifact GC åŠŸèƒ½ï¼ˆä½¿ç”¨æ–°è·¯å¾„ï¼‰ | å¦ |
| `tests/logbook/test_identity_sync.py` | èº«ä»½åŒæ­¥åŠŸèƒ½ | å¦ |
| `tests/gateway/test_importerror_optional_deps_contract.py` | å¯é€‰ä¾èµ–ç¼ºå¤±æ—¶çš„é”™è¯¯å¤„ç† | å¦ |
| `tests/logbook/test_deprecation_warnings.py`ï¼ˆå¦‚æœ‰ï¼‰ | å¼ƒç”¨è­¦å‘Šæ­£ç¡®å‘å‡º | **æ˜¯**ï¼ˆæµ‹è¯•å¼ƒç”¨è¡Œä¸ºï¼‰ |

### æ‰¹é‡è¿ç§» PR éªŒæ”¶

æäº¤æ‰¹é‡è¿ç§» PR æ—¶ï¼Œé™¤å¸¸è§„ CI æ£€æŸ¥å¤–ï¼Œè¿˜éœ€éªŒè¯ï¼š

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| **æµ‹è¯•æ— æ–°å¢å¤±è´¥** | å¯¹æ¯” PR å‰åçš„æµ‹è¯•é€šè¿‡æ•° |
| **æ— é—æ¼çš„ import** | `make check-no-root-wrappers --verbose` æ— æ–°å¢è¿è§„ |
| **ä¾‹å¤–å£°æ˜æœ‰æ•ˆ** | æ–°å¢çš„ inline marker æ ¼å¼æ­£ç¡®ã€æœªè¿‡æœŸ |
| **æ–‡æ¡£åŒæ­¥æ›´æ–°** | è¿ç§»æ˜ å°„æ–‡æ¡£ä¸ä»£ç ä¸€è‡´ |

### è¿ç§»éªŒæ”¶ä¸å¸¸è§„éªŒæ”¶çš„å…³ç³»

è¿ç§»éªŒæ”¶æ£€æŸ¥å·²é›†æˆåˆ°å¸¸è§„ CI æµç¨‹ï¼š

| CI Job | åŒ…å«çš„è¿ç§»æ£€æŸ¥ |
|--------|----------------|
| **lint** | - |
| **no-root-wrappers-usage** | `check_no_root_wrappers_usage.py`ï¼ˆæ ¸å¿ƒæ£€æŸ¥ï¼‰ |
| **cli-entrypoints-consistency** | CLI å…¥å£ä¸ pyproject.toml ä¸€è‡´æ€§ |
| **test** | æµ‹è¯•è¿ç§»åçš„ import è·¯å¾„æ˜¯å¦æ­£å¸¸å·¥ä½œ |

æ— éœ€å•ç‹¬è¿è¡Œè¿ç§»éªŒæ”¶ï¼Œ`make ci` å·²è¦†ç›–æ‰€æœ‰è¿ç§»ç›¸å…³æ£€æŸ¥ã€‚

---

## é™„å½•ï¼šéªŒæ”¶æ ‡å‡†

### PASS æ ‡å‡†

- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡
- å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸å“åº”
- æ— é˜»å¡æ€§ç¼ºé™·

### PARTIAL æ ‡å‡†

- æ ¸å¿ƒåŠŸèƒ½å¯ç”¨
- å­˜åœ¨æœªè¦†ç›–çš„æµ‹è¯•èŒƒå›´
- å·²çŸ¥é™åˆ¶å·²è®°å½•ä¸”é£é™©å¯æ§

### FAIL æ ‡å‡†

- æ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨
- é˜»å¡æ€§ç¼ºé™·æœªè§£å†³
- å…³é”®æµ‹è¯•å¤±è´¥
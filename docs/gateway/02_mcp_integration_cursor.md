# Cursor 侧 MCP 集成（推荐：连接 Gateway）

> **相关文档**：
> - [Gateway ↔ Logbook 边界契约](../contracts/gateway_logbook_boundary.md) — 组件职责划分、接口规范
> - [根 README 快速开始](../../README.md#mcp-配置cursoride-集成) — 部署与健康检查
> - [根 README §统一栈验证入口](../../README.md#统一栈验证入口) — 验证命令与脚本
> - [失败降级文档](05_failure_degradation.md) — 降级机制与 Outbox 详解
>
> **外部参考**：
> - [MCP 协议规范][mcp-spec] — Model Context Protocol 官方规范
> - [MCP JSON-RPC 传输规范][mcp-transport] — HTTP 传输层协议细节
> - [Cursor MCP 配置指南][cursor-mcp] — Cursor IDE 官方 MCP 集成文档
> - [MCP Server 添加方法][cursor-mcp-install] — 如何在 Cursor 中添加 MCP Server
> - [MCP Server 目录][mcp-directory] — 社区 MCP Server 列表
> - [Cursor Rules 配置][cursor-rules] — 自定义 Agent 行为规则
>
> **SSOT 声明**：本仓库 MCP 配置以 `configs/mcp/.mcp.json.example` 为权威来源，外部链接仅作行为参考。

[mcp-spec]: https://modelcontextprotocol.io/specification "MCP Protocol Specification"
[mcp-transport]: https://modelcontextprotocol.io/specification/2025-03-26/basic/transports "MCP Transports - Streamable HTTP"
[cursor-mcp]: https://docs.cursor.com/context/model-context-protocol "Cursor MCP Documentation"
[cursor-mcp-install]: https://docs.cursor.com/context/model-context-protocol#adding-mcp-servers "Adding MCP Servers"
[mcp-directory]: https://cursor.directory/ "MCP Server Directory"
[cursor-rules]: https://docs.cursor.com/context/rules-for-ai "Cursor Rules for AI"

## 方案 A（推荐）：Cursor -> Memory Gateway -> OpenMemory
优点：
- 强制执行 team_write 开关与策略
- 统一审计与降级（写 Logbook outbox）
- 可逐步扩展更多工具（promotion、reinforce 合并等）

## Cursor 配置模板
见 `configs/mcp/.mcp.json.example`（把 url 指向 Gateway 的 /mcp）

---

## 端到端集成指南（已有项目）

本节提供将 Memory Gateway 集成到已有项目的完整步骤。

### 前置条件

| 条件 | 说明 |
|------|------|
| Gateway 服务已部署 | 通过 `make deploy` 或独立部署 |
| 网络可达 | IDE 所在机器能访问 Gateway 地址 |
| 项目治理设置 | 已通过 Logbook 配置 `team_write_enabled` |

### 补充：Windows + WSL2 部署时，让局域网其它机器可达

如果 Gateway 跑在 Windows 的 WSL2 里，Windows 本机通常可以用 `http://localhost:8787` 访问；但 **WSL2 默认是 NAT**，局域网其它机器一般 **无法直连 WSL2 IP**。

- **服务端（Windows 机器）**：按 `docs/gateway/01_openmemory_deploy_windows.md` 的 “B.9 Windows / 局域网访问说明” 配置 mirrored networking 或 `portproxy` + Windows 防火墙放行
- **客户端（其它机器）**：把 `.cursor/mcp.json`（或 `~/.cursor/mcp.json`）里的 `url` 从 `http://127.0.0.1:8787/mcp` 改成 `http://<windows-lan-ip>:8787/mcp`

### 步骤 1: 配置 `.cursor/mcp.json`

在项目根目录创建 `.cursor/mcp.json`（或编辑 `~/.cursor/mcp.json` 全局配置）：

> **注意**：配置示例参见 `configs/mcp/.mcp.json.example`

**最小配置**：

**默认 server**：`engram`

**示例命令（显式指定 server）**：

```bash
# 以 MCP 客户端为例，显式选择 engram server
mcp-client --server engram tools/list
```

<!-- BEGIN GENERATED: mcp_config_snippet -->
<!-- AUTO-GENERATED BY render_mcp_config_snippet.py; DO NOT EDIT -->

```json
{
  "mcpServers": {
    "engram": {
      "type": "http",
      "url": "http://127.0.0.1:8787/mcp"
    }
  }
}
```

> 说明：`Authorization: Bearer <your-api-key>` 需与服务端 `GATEWAY_AUTH_TOKEN` 或 `GATEWAY_AUTH_TOKENS_JSON` 配置匹配。
<!-- END GENERATED -->

**生产配置（带认证）**：

```json
{
  "mcpServers": {
    "engram": {
      "type": "http",
      "url": "https://gateway.example.com/mcp",
      "headers": {
        "Authorization": "Bearer <your-api-key>",
        "X-Project-Key": "myproject"
      }
    }
  }
}
```

**多环境配置**：

```json
{
  "mcpServers": {
    "engram-dev": {
      "type": "http",
      "url": "http://127.0.0.1:8787/mcp"
    },
    "engram-prod": {
      "type": "http",
      "url": "https://gateway.prod.example.com/mcp",
      "headers": {
        "Authorization": "Bearer ${GATEWAY_API_KEY}"
      }
    }
  }
}
```

### 步骤 2: 环境变量（服务端）

Gateway 服务端需要以下环境变量：

**必需变量**：

| 变量 | 示例值 | 说明 |
|------|--------|------|
| `POSTGRES_DSN` | `postgresql://logbook_svc:pwd@localhost:5432/engram` | Logbook 数据库连接 |
| `OPENMEMORY_BASE_URL` | `http://localhost:8080` | OpenMemory 服务地址 |

**可选变量**：

| 变量 | 默认值 | 说明 |
|------|--------|------|
| `GATEWAY_PORT` | `8787` | Gateway HTTP 端口 |
| `GATEWAY_HOST` | `0.0.0.0` | 绑定地址 |
| `GATEWAY_MODE` | `FULL` | 运行模式：`FULL` / `DEGRADED` |
| `GATEWAY_SKIP_RECONCILE` | `0` | 跳过 Reconcile 能力（`1` 跳过） |
| `GATEWAY_LOG_LEVEL` | `INFO` | 日志级别 |
| `GATEWAY_AUTH_TOKEN` | *(空)* | 启用 MCP Bearer Token 鉴权（单 token） |
| `GATEWAY_AUTH_TOKENS_JSON` | *(空)* | 启用 MCP Bearer Token 鉴权（JSON 数组） |

**降级开关**（用于故障隔离）：

| 变量 | 默认值 | 作用 |
|------|--------|------|
| `GATEWAY_OPENMEMORY_ENABLED` | `1` | 禁用时记忆直接入 Outbox |
| `GATEWAY_AUDIT_ENABLED` | `1` | 禁用时跳过审计写入（**慎用**） |
| `GATEWAY_OUTBOX_ENABLED` | `1` | 禁用时失败直接报错（不缓冲） |

### 步骤 3: 健康检查

**Gateway 健康检查**：

```bash
# HTTP 健康检查
curl -sf http://127.0.0.1:8787/health && echo "Gateway OK"

# 预期响应
{"status":"ok","mode":"FULL","capabilities":{"openmemory":true,"logbook":true}}
```

Windows PowerShell：

```powershell
Invoke-RestMethod http://127.0.0.1:8787/health
```

**依赖服务检查**：

```bash
# OpenMemory
curl -sf http://127.0.0.1:8080/health && echo "OpenMemory OK"

# PostgreSQL (通过 Logbook CLI)
engram-logbook health --dsn "postgresql://..."
```

Windows PowerShell：

```powershell
Invoke-RestMethod http://127.0.0.1:8080/health
engram-logbook health --dsn "postgresql://..."
```

**MCP 端点检查**：

```bash
# 测试 tools/list
curl -X POST http://127.0.0.1:8787/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'

# 预期：返回 tools 数组
```

Windows PowerShell：

```powershell
Invoke-RestMethod -Method Post -Uri http://127.0.0.1:8787/mcp -ContentType "application/json" `
  -Body '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
```

**一键诊断（推荐）**：

```bash
# 支持 GATEWAY_URL / MCP_DOCTOR_TIMEOUT / MCP_DOCTOR_AUTHORIZATION
# 额外请求头可用 --header "Key: Value"（可重复）
make mcp-doctor
```

Windows PowerShell（无 make）：

```powershell
python scripts/ops/mcp_doctor.py --gateway-url http://127.0.0.1:8787
```

诊断字段与排障流程参见 [MCP Doctor 诊断 Runbook](../dev/ci_gate_runbook.md#06-mcp-doctor-诊断-runbook)，
检查矩阵附录见 [MCP Doctor 检查矩阵](../dev/ci_gate_runbook.md#064-mcp-doctor-检查矩阵附录)。

### 最小回归矩阵（MCP/Gateway）

当修改 `src/engram/gateway/api_models.py`、`src/engram/gateway/routes.py`、`src/engram/gateway/middleware.py` 或 `scripts/ops/mcp_doctor.py` 任一处时，**必须**执行以下最小回归矩阵：

```bash
pytest scripts/tests/test_mcp_doctor.py -q
pytest tests/gateway/test_mcp_cors_preflight.py -q
pytest tests/gateway/test_mcp_jsonrpc_contract.py -q

# 本地运行 Gateway 后执行
python scripts/ops/mcp_doctor.py --gateway-url http://127.0.0.1:8787

# 需要鉴权时（示例）
python scripts/ops/mcp_doctor.py --gateway-url http://127.0.0.1:8787 \
  --header "Authorization: Bearer <token>"
```

**完整验收脚本**：

```bash
#!/bin/bash
set -e

GATEWAY_URL=${GATEWAY_URL:-http://127.0.0.1:8787}

echo "=== Gateway 集成验收 ==="

# 1. 健康检查
echo -n "健康检查... "
curl -sf "$GATEWAY_URL/health" > /dev/null && echo "OK" || { echo "FAIL"; exit 1; }

# 2. CORS 预检
echo -n "CORS OPTIONS... "
CORS_HEADERS=$(curl -s -D - -o /dev/null -X OPTIONS "$GATEWAY_URL/mcp" \
  -H "Origin: http://example.com" \
  -H "Access-Control-Request-Method: POST" \
  -H "Access-Control-Request-Headers: Authorization, Mcp-Session-Id")
STATUS=$(echo "$CORS_HEADERS" | awk 'NR==1 {print $2}')
if [ "$STATUS" != "200" ] && [ "$STATUS" != "204" ]; then
  echo "FAIL ($STATUS)"
  exit 1
fi
EXPOSE_HEADERS=$(echo "$CORS_HEADERS" | grep -i "^Access-Control-Expose-Headers:" | cut -d':' -f2- | tr -d '\r')
echo "$EXPOSE_HEADERS" | grep -qi "X-Correlation-ID" || { echo "FAIL (missing X-Correlation-ID expose)"; exit 1; }
echo "$EXPOSE_HEADERS" | grep -qi "Mcp-Session-Id" || { echo "FAIL (missing Mcp-Session-Id expose)"; exit 1; }
echo "OK ($STATUS)"

# 3. tools/list
echo -n "tools/list... "
TOOLS=$(curl -sf -X POST "$GATEWAY_URL/mcp" \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | jq -r '.result.tools | length')
[ "$TOOLS" -gt 0 ] && echo "OK ($TOOLS tools)" || { echo "FAIL"; exit 1; }

echo "=== 验收通过 ==="
```

### 步骤 4: 降级开关使用

当 OpenMemory 或其他依赖不可用时，可通过降级开关隔离故障：

**场景 1: OpenMemory 不可用**

```bash
# 临时禁用 OpenMemory，记忆写入 Outbox 等待重试
GATEWAY_OPENMEMORY_ENABLED=0 make up-gateway
```

**场景 2: 仅审计模式（调试用）**

```bash
# 仅记录审计，不实际写入记忆（用于调试流量）
GATEWAY_MODE=AUDIT_ONLY make up-gateway
```

**场景 3: 完全降级（紧急）**

```bash
# 所有能力禁用，Gateway 仅响应健康检查
GATEWAY_MODE=MINIMAL make up-gateway
```

### 步骤 5: 常见错误与排查

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|----------|------|----------|
| `CORS_PREFLIGHT_FAILED` | OPTIONS 请求失败 | Gateway CORS 配置缺失 | 检查 Gateway 是否响应 OPTIONS 200/204 且返回完整 CORS/Expose 头 |
| `TOOL_NOT_FOUND` | 工具不存在 | 工具未注册或名称错误 | 调用 `tools/list` 确认工具列表 |
| `TEAM_WRITE_DISABLED` | 团队写入已禁用 | 项目治理设置不允许写入 | 通过 Logbook 启用 `team_write_enabled` |
| `AUDIT_WRITE_FAILED` | 审计写入失败 | Logbook 数据库连接问题 | 检查 `POSTGRES_DSN` 配置 |
| `OPENMEMORY_UNAVAILABLE` | OpenMemory 不可用 | 服务未启动或网络不通 | 检查 `OPENMEMORY_BASE_URL` |
| `OUTBOX_ENQUEUE_FAILED` | Outbox 入队失败 | 数据库写入问题 | 检查数据库连接和磁盘空间 |
| `INVALID_CONTENT_FORMAT` | content 格式错误 | 响应不符合 MCP 规范 | 升级 Gateway 版本 |

**日志查看**：

```bash
# Gateway 日志
docker compose logs -f gateway

# 过滤错误
docker compose logs gateway 2>&1 | grep -i error

# 指定时间范围
docker compose logs --since 10m gateway
```

**调试模式**：

```bash
# 启用详细日志
GATEWAY_LOG_LEVEL=DEBUG make up-gateway

# 启用请求/响应日志
GATEWAY_LOG_REQUESTS=1 make up-gateway
```

---

## `.mcp.json` 配置规范

### 基础配置结构

```json
{
  "mcpServers": {
    "engram": {
      "type": "http",
      "url": "http://<server-ip>:<gateway-port>/mcp"
    }
  }
}
```

### 兼容性假设与约束

| 约束项 | 要求 | 说明 |
|--------|------|------|
| `type` | 必须为 `"http"` | Gateway 仅支持 HTTP 传输，不支持 stdio |
| `url` | 必须以 `/mcp` 结尾 | 标准 MCP 端点路径 |
| 协议 | HTTP 或 HTTPS | 生产环境建议使用 HTTPS |
| 认证 | 通过 Header 传递 | 使用 `Authorization` 头，Gateway 需配置对应中间件 |

### Cursor 行为假设

1. **请求格式**：Cursor 发送标准 JSON-RPC 2.0 请求
   - `method: "tools/call"` 用于工具调用
   - `method: "tools/list"` 用于获取工具列表
   - `method: "initialize"` 用于初始化握手（`params` 可缺省或 `{}`）
   - `method: "ping"` 可能用于连接保活（`params` 可缺省或 `{}`）

2. **initialize 响应最小字段**（对齐 MCP/Cursor 预期）：
   - `result.protocolVersion`
   - `result.capabilities`
   - `result.serverInfo`（含 `name`、`version`）

3. **Session 管理**：
   - Cursor 可能发送 `Mcp-Session-Id` 请求头
   - Gateway 需在 CORS 中允许该头部

4. **CORS 要求**：
   - Gateway 必须响应 `OPTIONS` 预检请求（`Access-Control-Request-Method` 存在时返回 204，否则 200 也可接受）
   - 必须设置 `Access-Control-Allow-Origin: *`
   - 必须允许 `Content-Type`, `Authorization`, `Mcp-Session-Id` 头（可按请求补全）
   - 必须暴露 `Mcp-Session-Id`, `X-Correlation-ID`（`Access-Control-Expose-Headers`）

**验证命令**：

```bash
# initialize: params 可缺省
curl -s -X POST http://127.0.0.1:8787/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize"}'

# ping: result 应为 {}
curl -s -X POST http://127.0.0.1:8787/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":2,"method":"ping"}'
```

### 配置示例（带认证）

```json
{
  "mcpServers": {
    "engram": {
      "type": "http",
      "url": "http://192.168.1.100:8787/mcp",
      "headers": {
        "Authorization": "Bearer <your-api-key>"
      }
    }
  }
}
```

### 常见问题排查

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 连接失败 | CORS 未正确配置 | 检查 Gateway 是否响应 OPTIONS 请求 |
| 工具未显示 | `tools/list` 响应异常 | 检查 Gateway 日志，确认工具注册 |
| 认证失败 | Header 未传递 | 确认 `.mcp.json` 中配置了 `headers` |
| 超时 | 网络不通 | 检查防火墙和网络连通性 |

---

## Cursor 常见问题详解

### 问题 1: 405 Method Not Allowed / OPTIONS 请求失败

**现象**：
- Cursor 显示连接失败或工具不可用
- 浏览器开发者工具中看到 OPTIONS 请求返回 405

**原因**：
Cursor 在实际请求前会发送 CORS 预检（OPTIONS）请求。如果 Gateway 未正确处理 OPTIONS，浏览器会阻止后续请求。

**解决方案**：
确保 Gateway `/mcp` 端点正确响应 OPTIONS（200/204 均可接受）：
```
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: POST,OPTIONS
Access-Control-Allow-Headers: Content-Type,Authorization,Mcp-Session-Id
Access-Control-Expose-Headers: Mcp-Session-Id, X-Correlation-ID
```

**验证命令**：
```bash
curl -X OPTIONS http://<gateway-url>/mcp -i
# 应返回 200/204 状态码和上述 CORS 头
```

### 问题 2: 工具调用返回 content 结构不符，导致工具不可用

**现象**：
- 工具列表正常显示，但调用工具时报错
- Cursor 显示 "Tool execution failed" 或类似错误
- Gateway 日志显示请求成功，但 Cursor 无法解析响应

**原因**：
MCP 协议要求 `tools/call` 响应中的 `result.content` 必须是数组格式，且每个元素必须包含 `type` 和对应字段（如 `text`）。

**错误示例**（Cursor 无法解析）：
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "content": "存储成功"  // ❌ 错误：content 应为数组
  }
}
```

**正确格式**：
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "content": [
      { "type": "text", "text": "存储成功，memory_id=mem_abc123" }
    ]
  }
}
```

**检查要点**：
1. `content` 必须是数组 `[]`
2. 数组元素必须包含 `type` 字段（通常为 `"text"`）
3. `type: "text"` 时必须有 `text` 字段
4. 业务错误应使用 `isError: true` 标记，而非返回 JSON-RPC error

### 问题 3: tools/list 返回空列表

**现象**：
- Cursor MCP 面板中显示已连接，但无工具可用

**可能原因**：
1. Gateway 尚未注册工具
2. `tools/list` 响应格式错误
3. 响应中 `result.tools` 不是数组

**正确响应格式**：
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "memory_store",
        "description": "存储记忆到 OpenMemory",
        "inputSchema": {
          "type": "object",
          "properties": { ... },
          "required": ["payload_md"]
        }
      }
    ]
  }
}
```

### 问题 4: Session 管理异常

**现象**：
- 首次调用成功，后续调用失败
- 出现 session 不匹配错误

**原因**：
Cursor 可能发送 `Mcp-Session-Id` 请求头进行会话管理。如果 Gateway 强制要求该头但未正确处理，会导致请求失败。

**建议**：
- Gateway 应允许 `Mcp-Session-Id` 头（在 CORS 中）
- 但不应强制要求该头存在（保持向后兼容）

---

## 协议支持说明

Gateway `/mcp` 端点支持两种协议格式，通过请求体字段自动识别：

| 协议格式 | 识别特征 | 适用场景 |
|----------|----------|----------|
| **标准 MCP JSON-RPC** | 包含 `jsonrpc: "2.0"` 和 `method` 字段 | Cursor、标准 MCP 客户端（推荐） |
| **简化模式** | 包含 `tool` 和 `arguments` 字段 | 脚本验证、内部调用 |

详细协议规范见 `README.md`。

### HTTP 端点行为参考

遵循上游 OpenMemory MCP 实现的 HTTP 行为：

- `POST /mcp`：处理 JSON-RPC 请求
- `OPTIONS /mcp`：CORS 预检（带 `Access-Control-Request-Method` 时返回 204，否则 200），返回 CORS 头（含 Expose-Headers）
- `GET/PUT/DELETE /mcp`：返回 405，错误码 `-32600`

详细错误码映射见 `README.md`。

---

## 外部参考

本章节汇总与 MCP 集成相关的外部文档，便于追踪协议变更与最佳实践。

> **SSOT 声明**：本仓库 MCP 配置以 `configs/mcp/.mcp.json.example` 为权威来源，外部链接仅作行为参考。

### MCP 协议规范

| 资源 | 说明 |
|------|------|
| [MCP 协议规范][mcp-spec] | Model Context Protocol 核心规范，定义 JSON-RPC 消息格式、工具调用接口 |
| [MCP 传输层规范][mcp-transport] | HTTP Streamable 传输协议，包含 CORS、Session 管理等细节 |
| [MCP 工具定义规范][mcp-tools] | `tools/list` 与 `tools/call` 的请求/响应格式 |

### Cursor 集成

| 资源 | 说明 |
|------|------|
| [Cursor MCP 文档][cursor-mcp] | Cursor IDE 官方 MCP 配置与使用指南 |
| [MCP Server 添加方法][cursor-mcp-install] | 如何在 Cursor 中添加和配置 MCP Server |
| [MCP Server 目录][mcp-directory] | 社区 MCP Server 列表（cursor.directory） |
| [Cursor Agent 模式][cursor-agent] | Agent 模式下的 MCP 工具调用行为 |
| [Cursor Rules 配置][cursor-rules] | 自定义 Agent 行为规则（Project Rules / User Rules） |
| [Project Rules][cursor-project-rules] | 项目级 Rules 配置方法 |

### 相关 ADR

| ADR | 说明 |
|-----|------|
| [MCP JSON-RPC 错误码契约](../contracts/mcp_jsonrpc_error_v2.md) | 本项目 MCP 错误码映射规范 |

---

> **版本追踪**：本文档基于 MCP 规范 2025-03-26 版本编写。当上游规范更新时，请同步检查兼容性。
>
> **文档更新**：2026-02-03（补充 MCP Doctor 检查矩阵附录链接）

---

## Cursor Rules 与本仓库映射

本仓库的 `AGENTS.md`（根目录）作为 [Cursor Workspace Rules][cursor-rules] 自动加载，提供 AI Agent 协作规范。

| Cursor 概念 | 本仓库对应 | 说明 |
|-------------|-----------|------|
| **Workspace Rules** | `AGENTS.md` | 自动应用于所有对话，定义门禁命令、子代理分工 |
| **Project Rules** | `.cursor/` 目录（可选） | 项目级规则，可继承 workspace rules |
| **User Rules** | Cursor 设置中配置 | 个人偏好，如语言设置 |
| **MCP 配置** | `configs/mcp/.mcp.json.example` | MCP Server 连接配置模板（SSOT） |

详细的 Agent 协作指南见 [docs/dev/agents.md](../dev/agents.md)。

[mcp-spec]: https://modelcontextprotocol.io/specification "MCP Protocol Specification"
[mcp-transport]: https://modelcontextprotocol.io/specification/2025-03-26/basic/transports "MCP Transports"
[mcp-tools]: https://modelcontextprotocol.io/specification/2025-03-26/server/tools "MCP Tools"
[cursor-mcp]: https://docs.cursor.com/context/model-context-protocol "Cursor MCP Documentation"
[cursor-mcp-install]: https://docs.cursor.com/context/model-context-protocol#adding-mcp-servers "Adding MCP Servers"
[mcp-directory]: https://cursor.directory/ "MCP Server Directory"
[cursor-agent]: https://docs.cursor.com/chat/agent "Cursor Agent Mode"
[cursor-rules]: https://docs.cursor.com/context/rules-for-ai "Cursor Rules for AI"
[cursor-project-rules]: https://docs.cursor.com/context/rules-for-ai#project-rules "Project Rules"
